---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  description?: string;
  currentPath?: string;
}

const { title, description, currentPath } = Astro.props;

const navigation = [
  {
    title: '시작하기',
    items: [
      { label: '60분 완주 (React + FastAPI)', href: '/start/60min' },
      { label: '→ 프론트엔드', href: '/start/60min/frontend/react' },
      { label: '→ 백엔드', href: '/start/60min/backend/fastapi' },
      { label: '→ 연결', href: '/start/60min/connect' },
      { label: '→ 배포', href: '/start/60min/deploy' },
      { label: '→ 완료', href: '/start/60min/complete' },
    ],
  },
  {
    title: '학습 사이클',
    items: [
      { label: 'Cycle 0: 개요', href: '/cycle/0-overview' },
      { label: 'Cycle 0: 도구', href: '/cycle/0-tools' },
      { label: 'Cycle 1: DNS', href: '/cycle/1-dns' },
      { label: 'Cycle 2: Frontend', href: '/cycle/2-frontend' },
      { label: 'Cycle 3: Backend', href: '/cycle/3-backend' },
      { label: 'Cycle 4: 데이터베이스', href: '/cycle/4-database' },
      { label: 'Cycle 5: Runtime', href: '/cycle/5-runtime' },
      { label: 'Cycle 6: Ops', href: '/cycle/6-ops' },
      { label: '인증 가이드', href: '/cycle/auth' },
    ],
  },
  {
    title: 'Agent Recipes',
    items: [
      { label: 'Core Pack (10개)', href: '/agent-recipes' },
    ],
  },
  {
    title: '배포 레퍼런스',
    items: [
      { label: 'Cloudflare Pages', href: '/deploy/cloudflare-pages' },
      { label: 'Cloud Run', href: '/deploy/cloud-run' },
    ],
  },
  {
    title: '트러블슈팅',
    items: [
      { label: 'CORS 에러', href: '/troubleshooting/cors' },
      { label: '환경 변수', href: '/troubleshooting/env' },
      { label: 'SPA 404', href: '/troubleshooting/spa-404' },
      { label: '빌드 실패', href: '/troubleshooting/build-fail' },
      { label: '인증/쿠키', href: '/troubleshooting/auth-cookie' },
    ],
  },
];
---

<BaseLayout title={title} description={description}>
  <div class="min-h-screen flex flex-col">
    <!-- 헤더 -->
    <header class="sticky top-0 z-50 border-b border-border bg-background/80 backdrop-blur-md">
      <div class="max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-14">
          <div class="flex items-center gap-4">
            <a href="/" class="flex items-center gap-2" aria-label="Choorai 홈">
              <img src="/favicon.png" alt="" class="w-7 h-7" aria-hidden="true" />
              <span class="text-lg font-bold">Choorai</span>
            </a>
            <span class="text-border">|</span>
            <span class="text-sm text-text-secondary">문서</span>
          </div>

          <div class="flex items-center gap-4">
            <!-- 검색 -->
            <div class="hidden md:flex items-center h-9 w-64 rounded-lg border border-border bg-surface px-3">
              <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <input
                type="search"
                placeholder="문서 검색..."
                aria-label="문서 검색"
                class="flex-1 bg-transparent border-none text-sm text-white placeholder:text-text-secondary px-2 focus:outline-none"
              />
              <kbd class="text-[10px] text-text-secondary bg-background px-1.5 py-0.5 rounded border border-border" aria-hidden="true">⌘K</kbd>
            </div>

            <a href="https://github.com/curogom/choorai" class="text-text-secondary hover:text-white transition-colors" aria-label="GitHub 저장소">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </header>

    <div class="flex-1 flex">
      <!-- 사이드바 -->
      <aside class="hidden lg:block w-64 border-r border-border bg-background sticky top-14 h-[calc(100vh-3.5rem)] overflow-y-auto" role="navigation" aria-label="문서 네비게이션">
        <nav class="p-4 space-y-6">
          {navigation.map((section) => (
            <div>
              <h3 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 px-3">
                {section.title}
              </h3>
              <ul class="space-y-1">
                {section.items.map((item) => (
                  <li>
                    <a
                      href={item.href}
                      class={`
                        flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium
                        transition-colors
                        ${currentPath === item.href
                          ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                          : 'text-text-secondary hover:text-white hover:bg-surface'
                        }
                      `}
                    >
                      {item.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </nav>
      </aside>

      <!-- 메인 콘텐츠 -->
      <main class="flex-1 min-w-0">
        <slot />
      </main>
    </div>
  </div>
</BaseLayout>
