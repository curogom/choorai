---
import BaseLayout from './BaseLayout.astro';
import CollapsibleNavGroup from '../components/CollapsibleNavGroup';

interface Props {
  title: string;
  description?: string;
  currentPath?: string;
}

const { title, description, currentPath } = Astro.props;

// 60ë¶„ ì™„ì£¼ í•˜ìœ„ ê·¸ë£¹
const startGroups = {
  frontend: {
    title: 'í”„ë¡ íŠ¸ì—”ë“œ',
    icon: 'ğŸ¨',
    items: [
      { label: 'React', href: '/start/60min/frontend/react', description: 'ê°€ì¥ ì¸ê¸°ìˆëŠ” ì„ íƒ' },
      { label: 'Vue', href: '/start/60min/frontend/vue', description: 'ì‰¬ìš´ í…œí”Œë¦¿ ë¬¸ë²•' },
    ],
  },
  backend: {
    title: 'ë°±ì—”ë“œ',
    icon: 'âš™ï¸',
    items: [
      { label: 'FastAPI', href: '/start/60min/backend/fastapi', badge: 'ì¶”ì²œ', description: 'Python ë°±ì—”ë“œ' },
      { label: 'Hono', href: '/start/60min/backend/hono', description: 'JavaScript ë°±ì—”ë“œ' },
    ],
  },
};

// ì‹œì‘í•˜ê¸° ì„¹ì…˜
const startSection = {
  title: 'ğŸš€ ì‹œì‘í•˜ê¸°',
  mainItems: [
    { label: '60ë¶„ ì™„ì£¼', href: '/start/60min', badge: 'ì¶”ì²œ' },
  ],
  groups: startGroups,
  stepItems: [
    { label: 'ì—°ê²°í•˜ê¸°', href: '/start/60min/connect' },
    { label: 'ë°°í¬í•˜ê¸°', href: '/start/60min/deploy' },
    { label: 'ì™„ë£Œ!', href: '/start/60min/complete' },
  ],
  toolItems: [
    { label: 'ë„êµ¬ ì¤€ë¹„', href: '/cycle/0-tools' },
  ],
};

// ë” ê¹Šê²Œ ì•Œì•„ë³´ê¸° ì„¹ì…˜
const deepDiveNavigation = [
  {
    title: 'ğŸ“– ê°€ì´ë“œ ëª©ë¡',
    items: [
      { label: 'ì „ì²´ ê°€ì´ë“œ', href: '/cycle/0-overview' },
    ],
  },
  {
    title: 'ğŸŒ ë„ë©”ì¸',
    items: [
      { label: 'DNS ì„¤ì •', href: '/cycle/1-dns' },
    ],
  },
  {
    title: 'ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ',
    items: [
      { label: 'React ì‹¬í™”', href: '/cycle/2-frontend' },
      { label: 'Vue ì‹¬í™”', href: '/cycle/2-frontend/vue' },
    ],
  },
  {
    title: 'âš™ï¸ ë°±ì—”ë“œ',
    items: [
      { label: 'FastAPI ì‹¬í™”', href: '/cycle/3-backend' },
      { label: 'Hono ì‹¬í™”', href: '/cycle/3-backend/hono' },
      { label: 'Go', href: '/cycle/3-backend/go' },
      { label: 'NestJS', href: '/cycle/3-backend/nest' },
    ],
  },
  {
    title: 'ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤',
    items: [
      { label: 'ê°œìš”', href: '/cycle/4-database' },
      { label: 'Supabase', href: '/cycle/4-database/supabase' },
    ],
  },
  {
    title: 'ğŸ” ì¸ì¦',
    items: [
      { label: 'ê°œìš”', href: '/cycle/auth' },
      { label: 'Clerk', href: '/cycle/auth/clerk', badge: 'ì¶”ì²œ' },
      { label: 'NextAuth', href: '/cycle/auth/nextauth' },
      { label: 'Auth0', href: '/cycle/auth/auth0' },
      { label: 'Firebase', href: '/cycle/auth/firebase' },
    ],
  },
  {
    title: 'âš™ï¸ ìš´ì˜',
    items: [
      { label: 'í™˜ê²½ ë³€ìˆ˜', href: '/cycle/5-runtime' },
      { label: 'ëª¨ë‹ˆí„°ë§', href: '/cycle/6-ops' },
    ],
  },
  {
    title: 'ğŸ§ª í…ŒìŠ¤íŒ…',
    items: [
      { label: 'ê°œìš”', href: '/cycle/testing' },
      { label: 'ë‹¨ìœ„ í…ŒìŠ¤íŠ¸', href: '/cycle/testing/unit' },
      { label: 'E2E í…ŒìŠ¤íŠ¸', href: '/cycle/testing/e2e' },
    ],
  },
  {
    title: 'ğŸš€ ë°°í¬ í”Œë«í¼',
    items: [
      { label: 'Cloudflare Pages', href: '/deploy/cloudflare-pages' },
      { label: 'Vercel', href: '/deploy/vercel' },
      { label: 'Cloud Run', href: '/deploy/cloud-run' },
    ],
  },
  {
    title: 'ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…',
    items: [
      { label: 'CORS ì—ëŸ¬', href: '/troubleshooting/cors' },
      { label: 'í™˜ê²½ ë³€ìˆ˜', href: '/troubleshooting/env' },
      { label: 'SPA 404', href: '/troubleshooting/spa-404' },
      { label: 'ë¹Œë“œ ì‹¤íŒ¨', href: '/troubleshooting/build-fail' },
      { label: 'ì¸ì¦/ì¿ í‚¤', href: '/troubleshooting/auth-cookie' },
    ],
  },
  {
    title: 'ğŸ¤– Agent Recipes',
    items: [
      { label: 'Core Pack (10ê°œ)', href: '/agent-recipes' },
    ],
  },
];
---

<BaseLayout title={title} description={description}>
  <div class="min-h-screen flex flex-col">
    <!-- í—¤ë” -->
    <header class="sticky top-0 z-50 border-b border-border bg-background/80 backdrop-blur-md">
      <div class="max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-14">
          <div class="flex items-center gap-4">
            <!-- ëª¨ë°”ì¼ ë©”ë‰´ ë²„íŠ¼ -->
            <button
              id="mobile-menu-trigger"
              class="lg:hidden p-2 -ml-2 text-text-secondary hover:text-white transition-colors"
              aria-label="ë©”ë‰´ ì—´ê¸°"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
            <a href="/" class="flex items-center gap-2" aria-label="Choorai í™ˆ">
              <img src="/favicon.png" alt="" class="w-7 h-7" aria-hidden="true" />
              <span class="text-lg font-bold">Choorai</span>
            </a>
            <span class="text-border hidden sm:inline">|</span>
            <span class="text-sm text-text-secondary hidden sm:inline">ë¬¸ì„œ</span>
          </div>

          <div class="flex items-center gap-4">
            <!-- ê²€ìƒ‰ -->
            <button
              id="search-trigger"
              class="hidden md:flex items-center h-9 w-64 rounded-lg border border-border bg-surface px-3 hover:border-primary/50 transition-colors cursor-pointer"
              aria-label="ë¬¸ì„œ ê²€ìƒ‰ ì—´ê¸°"
            >
              <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <span class="flex-1 text-left text-sm text-text-secondary px-2">ë¬¸ì„œ ê²€ìƒ‰...</span>
              <kbd class="text-[10px] text-text-secondary bg-background px-1.5 py-0.5 rounded border border-border" aria-hidden="true">âŒ˜K</kbd>
            </button>

            <a href="https://github.com/curogom/choorai" class="text-text-secondary hover:text-white transition-colors" aria-label="GitHub ì €ì¥ì†Œ">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </header>

    <div class="flex-1 flex">
      <!-- ì‚¬ì´ë“œë°” -->
      <aside class="hidden lg:block w-64 border-r border-border bg-background sticky top-14 h-[calc(100vh-3.5rem)] overflow-y-auto">
        <nav class="p-4 space-y-6" aria-label="ë¬¸ì„œ ë„¤ë¹„ê²Œì´ì…˜">
          <!-- ì‹œì‘í•˜ê¸° ì„¹ì…˜ -->
          <div>
            <h3 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 px-3">
              {startSection.title}
            </h3>
            <ul class="space-y-1">
              {startSection.mainItems.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class={`
                      flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium
                      transition-colors
                      ${currentPath === item.href
                        ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                        : 'text-text-secondary hover:text-white hover:bg-surface'
                      }
                    `}
                  >
                    <span>{item.label}</span>
                    {item.badge && (
                      <span class="px-1.5 py-0.5 text-[10px] font-bold bg-primary/20 text-primary rounded">
                        {item.badge}
                      </span>
                    )}
                  </a>
                </li>
              ))}
            </ul>

            <!-- í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ í† ê¸€ ê·¸ë£¹ -->
            <CollapsibleNavGroup
              client:load
              title={startSection.groups.frontend.title}
              icon={startSection.groups.frontend.icon}
              items={startSection.groups.frontend.items}
              currentPath={currentPath}
              storageKey="start-frontend"
              defaultOpen={true}
            />
            <CollapsibleNavGroup
              client:load
              title={startSection.groups.backend.title}
              icon={startSection.groups.backend.icon}
              items={startSection.groups.backend.items}
              currentPath={currentPath}
              storageKey="start-backend"
              defaultOpen={true}
            />

            <!-- ì—°ê²°/ë°°í¬/ì™„ë£Œ ë‹¨ê³„ -->
            <ul class="space-y-1 mt-2">
              {startSection.stepItems.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class={`
                      flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium
                      transition-colors
                      ${currentPath === item.href
                        ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                        : 'text-text-secondary hover:text-white hover:bg-surface'
                      }
                    `}
                  >
                    <span>{item.label}</span>
                  </a>
                </li>
              ))}
            </ul>

            <!-- ë„êµ¬ ì¤€ë¹„ -->
            <ul class="space-y-1 mt-2 pt-2 border-t border-border/30">
              {startSection.toolItems.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class={`
                      flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium
                      transition-colors
                      ${currentPath === item.href
                        ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                        : 'text-text-secondary hover:text-white hover:bg-surface'
                      }
                    `}
                  >
                    <span>{item.label}</span>
                  </a>
                </li>
              ))}
            </ul>
          </div>

          <!-- êµ¬ë¶„ì„  -->
          <div class="border-t border-border/50 pt-4">
            <h3 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 px-3">
              ğŸ“š ë” ê¹Šê²Œ ì•Œì•„ë³´ê¸°
            </h3>
          </div>

          <!-- ë” ê¹Šê²Œ ì•Œì•„ë³´ê¸° ì„¹ì…˜ë“¤ -->
          {deepDiveNavigation.map((section) => (
            <div>
              <h3 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 px-3">
                {section.title}
              </h3>
              <ul class="space-y-1">
                {section.items.map((item) => (
                  <li>
                    <a
                      href={item.href}
                      class={`
                        flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium
                        transition-colors
                        ${currentPath === item.href
                          ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                          : 'text-text-secondary hover:text-white hover:bg-surface'
                        }
                      `}
                    >
                      <span>{item.label}</span>
                      {item.badge && (
                        <span class="px-1.5 py-0.5 text-[10px] font-bold bg-primary/20 text-primary rounded">
                          {item.badge}
                        </span>
                      )}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </nav>
      </aside>

      <!-- ë©”ì¸ ì½˜í…ì¸  -->
      <main class="flex-1 min-w-0">
        <slot />

        <!-- ë¬¸ì„œ í˜ì´ì§€ í‘¸í„° -->
        <footer class="border-t border-border bg-surface/30 py-8 mt-16">
          <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
              <div class="flex items-center gap-2">
                <img src="/favicon.png" alt="" class="w-5 h-5" aria-hidden="true" />
                <span class="text-white font-medium">Choorai</span>
                <span class="text-text-secondary text-sm">Â· ë¬¸ì„œ</span>
              </div>
              <div class="flex items-center gap-4 text-sm">
                <a href="/" class="text-text-secondary hover:text-white transition-colors">í™ˆ</a>
                <a href="https://github.com/curogom/choorai" target="_blank" rel="noopener noreferrer" class="text-text-secondary hover:text-white transition-colors flex items-center gap-1">
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" />
                  </svg>
                  GitHub
                </a>
                <a href="/terms" class="text-text-secondary hover:text-white transition-colors">ì´ìš©ì•½ê´€</a>
              </div>
            </div>
            <p class="text-xs text-text-secondary text-center mt-4">
              Â© {new Date().getFullYear()} CuroGom Â· Made with Choorai
            </p>
          </div>
        </footer>
      </main>
    </div>
  </div>

  <!-- ëª¨ë°”ì¼ ì‚¬ì´ë“œë°” -->
  <div id="mobile-sidebar" class="fixed inset-0 z-[90] lg:hidden hidden" role="dialog" aria-modal="true" aria-label="ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" id="mobile-overlay" aria-hidden="true"></div>
    <div class="absolute top-0 left-0 w-72 h-full bg-background border-r border-border shadow-2xl transform transition-transform duration-300" id="mobile-drawer">
      <div class="flex items-center justify-between h-14 px-4 border-b border-border">
        <span class="text-lg font-bold">ë©”ë‰´</span>
        <button id="mobile-menu-close" class="p-2 text-text-secondary hover:text-white transition-colors" aria-label="ë©”ë‰´ ë‹«ê¸°">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <nav class="p-4 space-y-6 overflow-y-auto h-[calc(100%-3.5rem)]" aria-label="ë¬¸ì„œ ë„¤ë¹„ê²Œì´ì…˜">
        <!-- ì‹œì‘í•˜ê¸° ì„¹ì…˜ (ëª¨ë°”ì¼) -->
        <div>
          <h3 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 px-3">
            {startSection.title}
          </h3>
          <ul class="space-y-1">
            {startSection.mainItems.map((item) => (
              <li>
                <a
                  href={item.href}
                  class={`
                    flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium
                    transition-colors
                    ${currentPath === item.href
                      ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                      : 'text-text-secondary hover:text-white hover:bg-surface'
                    }
                  `}
                >
                  <span>{item.label}</span>
                  {item.badge && (
                    <span class="px-1.5 py-0.5 text-[10px] font-bold bg-primary/20 text-primary rounded">
                      {item.badge}
                    </span>
                  )}
                </a>
              </li>
            ))}
          </ul>

          <!-- í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ í† ê¸€ ê·¸ë£¹ (ëª¨ë°”ì¼) -->
          <CollapsibleNavGroup
            client:load
            title={startSection.groups.frontend.title}
            icon={startSection.groups.frontend.icon}
            items={startSection.groups.frontend.items}
            currentPath={currentPath}
            storageKey="mobile-start-frontend"
            defaultOpen={true}
          />
          <CollapsibleNavGroup
            client:load
            title={startSection.groups.backend.title}
            icon={startSection.groups.backend.icon}
            items={startSection.groups.backend.items}
            currentPath={currentPath}
            storageKey="mobile-start-backend"
            defaultOpen={true}
          />

          <!-- ì—°ê²°/ë°°í¬/ì™„ë£Œ ë‹¨ê³„ (ëª¨ë°”ì¼) -->
          <ul class="space-y-1 mt-2">
            {startSection.stepItems.map((item) => (
              <li>
                <a
                  href={item.href}
                  class={`
                    flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium
                    transition-colors
                    ${currentPath === item.href
                      ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                      : 'text-text-secondary hover:text-white hover:bg-surface'
                    }
                  `}
                >
                  <span>{item.label}</span>
                </a>
              </li>
            ))}
          </ul>

          <!-- ë„êµ¬ ì¤€ë¹„ (ëª¨ë°”ì¼) -->
          <ul class="space-y-1 mt-2 pt-2 border-t border-border/30">
            {startSection.toolItems.map((item) => (
              <li>
                <a
                  href={item.href}
                  class={`
                    flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium
                    transition-colors
                    ${currentPath === item.href
                      ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                      : 'text-text-secondary hover:text-white hover:bg-surface'
                    }
                  `}
                >
                  <span>{item.label}</span>
                </a>
              </li>
            ))}
          </ul>
        </div>

        <!-- êµ¬ë¶„ì„  (ëª¨ë°”ì¼) -->
        <div class="border-t border-border/50 pt-4">
          <h3 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 px-3">
            ğŸ“š ë” ê¹Šê²Œ ì•Œì•„ë³´ê¸°
          </h3>
        </div>

        <!-- ë” ê¹Šê²Œ ì•Œì•„ë³´ê¸° ì„¹ì…˜ë“¤ (ëª¨ë°”ì¼) -->
        {deepDiveNavigation.map((section) => (
          <div>
            <h3 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 px-3">
              {section.title}
            </h3>
            <ul class="space-y-1">
              {section.items.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class={`
                      flex items-center justify-between px-3 py-2 rounded-lg text-sm font-medium
                      transition-colors
                      ${currentPath === item.href
                        ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                        : 'text-text-secondary hover:text-white hover:bg-surface'
                      }
                    `}
                  >
                    <span>{item.label}</span>
                    {item.badge && (
                      <span class="px-1.5 py-0.5 text-[10px] font-bold bg-primary/20 text-primary rounded">
                        {item.badge}
                      </span>
                    )}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        ))}
      </nav>
    </div>
  </div>

  <!-- ê²€ìƒ‰ ëª¨ë‹¬ -->
  <div id="search-modal" class="fixed inset-0 z-[100] hidden" role="dialog" aria-modal="true" aria-label="ë¬¸ì„œ ê²€ìƒ‰">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" id="search-overlay" aria-hidden="true"></div>
    <div class="relative max-w-2xl mx-auto mt-20 bg-background border border-border rounded-xl shadow-2xl overflow-hidden">
      <div class="p-4">
        <div id="pagefind-container"></div>
      </div>
    </div>
  </div>

  <script>
    // Pagefind ì´ˆê¸°í™” (lazy loading - ê²€ìƒ‰ ëª¨ë‹¬ ì—´ ë•Œë§Œ ë¡œë“œ)
    let pagefindLoaded = false;

    async function initSearch() {
      if (pagefindLoaded) return;
      pagefindLoaded = true;

      try {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = '/pagefind/pagefind-ui.css';
        document.head.appendChild(link);

        const style = document.createElement('style');
        style.textContent = `
          .pagefind-ui { --pagefind-ui-scale: 1; --pagefind-ui-primary: #57ABFF; --pagefind-ui-text: #fff; --pagefind-ui-background: #161B22; --pagefind-ui-border: #30363D; --pagefind-ui-tag: #21262D; --pagefind-ui-border-width: 1px; --pagefind-ui-border-radius: 8px; }
          .pagefind-ui__search-input { background: #0D1117 !important; }
          .pagefind-ui__result-link { color: #57ABFF !important; }
          .pagefind-ui__result-excerpt { color: #8B949E !important; }
        `;
        document.head.appendChild(style);

        const script = document.createElement('script');
        script.src = '/pagefind/pagefind-ui.js';
        script.onerror = () => {
          const container = document.getElementById('pagefind-container');
          if (container) {
            container.innerHTML = '<p class="text-text-secondary text-sm">ê²€ìƒ‰ ê¸°ëŠ¥ì€ ë¹Œë“œ í›„ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>';
          }
        };
        script.onload = () => {
          // @ts-ignore
          new PagefindUI({
            element: '#pagefind-container',
            showSubResults: true,
            showImages: false,
            translations: { placeholder: 'ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...', zero_results: 'ê²°ê³¼ ì—†ìŒ', many_results: '[COUNT]ê°œ ê²°ê³¼', one_result: '1ê°œ ê²°ê³¼' }
          });
        };
        document.head.appendChild(script);
      } catch (e) {
        console.warn('Pagefind not available in dev mode');
      }
    }

    // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
    const modal = document.getElementById('search-modal');
    const trigger = document.getElementById('search-trigger');
    const overlay = document.getElementById('search-overlay');

    function openSearch() {
      modal?.classList.remove('hidden');
      initSearch(); // ëª¨ë‹¬ ì—´ ë•Œ pagefind ë¡œë“œ
      setTimeout(() => (document.querySelector('.pagefind-ui__search-input') as HTMLElement)?.focus(), 100);
    }
    function closeSearch() { modal?.classList.add('hidden'); }

    trigger?.addEventListener('click', openSearch);
    overlay?.addEventListener('click', closeSearch);
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); openSearch(); }
      if (e.key === 'Escape') { closeSearch(); closeMobileMenu(); }
    });

    // ëª¨ë°”ì¼ ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°
    const mobileSidebar = document.getElementById('mobile-sidebar');
    const mobileOverlay = document.getElementById('mobile-overlay');
    const mobileTrigger = document.getElementById('mobile-menu-trigger');
    const mobileClose = document.getElementById('mobile-menu-close');

    function openMobileMenu() {
      mobileSidebar?.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
    function closeMobileMenu() {
      mobileSidebar?.classList.add('hidden');
      document.body.style.overflow = '';
    }

    mobileTrigger?.addEventListener('click', openMobileMenu);
    mobileClose?.addEventListener('click', closeMobileMenu);
    mobileOverlay?.addEventListener('click', closeMobileMenu);
  </script>
</BaseLayout>
