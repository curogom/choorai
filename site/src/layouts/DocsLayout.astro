---
import BaseLayout from './BaseLayout.astro';

interface Props {
  title: string;
  description?: string;
  currentPath?: string;
}

const { title, description, currentPath } = Astro.props;

const navigation = [
  {
    title: 'ì‹œì‘í•˜ê¸°',
    items: [
      { label: '60ë¶„ ì™„ì£¼ (React + FastAPI)', href: '/start/60min' },
      { label: 'â†’ í”„ë¡ íŠ¸ì—”ë“œ', href: '/start/60min/frontend/react' },
      { label: 'â†’ ë°±ì—”ë“œ', href: '/start/60min/backend/fastapi' },
      { label: 'â†’ ì—°ê²°', href: '/start/60min/connect' },
      { label: 'â†’ ë°°í¬', href: '/start/60min/deploy' },
      { label: 'â†’ ì™„ë£Œ', href: '/start/60min/complete' },
    ],
  },
  {
    title: 'ğŸ“š í•™ìŠµ ë¡œë“œë§µ',
    items: [
      { label: 'ê°œìš”: í•™ìŠµ ê²½ë¡œ', href: '/cycle/0-overview' },
      { label: 'Level 0: ë„êµ¬ ì¤€ë¹„', href: '/cycle/0-tools' },
    ],
  },
  {
    title: 'ğŸš€ ì„œë¹„ìŠ¤ ì‚¬ì´í´',
    items: [
      { label: 'Cycle 1: DNS', href: '/cycle/1-dns' },
      { label: 'Cycle 2: Frontend ë°°í¬', href: '/cycle/2-frontend' },
      { label: 'â†’ Vue (Lv.2)', href: '/cycle/2-frontend/vue' },
      { label: 'Cycle 3: Backend ë°°í¬', href: '/cycle/3-backend' },
      { label: 'â†’ Hono (Lv.1)', href: '/cycle/3-backend/hono' },
      { label: 'â†’ Go (Lv.3)', href: '/cycle/3-backend/go' },
      { label: 'â†’ NestJS (Lv.4)', href: '/cycle/3-backend/nest' },
      { label: 'Cycle 4: ë°ì´í„°ë² ì´ìŠ¤', href: '/cycle/4-database' },
      { label: 'â†’ Supabase (Lv.3)', href: '/cycle/4-database/supabase' },
      { label: 'Cycle 5: Runtime', href: '/cycle/5-runtime' },
      { label: 'Cycle 6: Ops', href: '/cycle/6-ops' },
      { label: 'ì¸ì¦ ê°€ì´ë“œ', href: '/cycle/auth' },
      { label: 'â†’ Clerk (Lv.2)', href: '/cycle/auth/clerk' },
      { label: 'â†’ NextAuth (Lv.3)', href: '/cycle/auth/nextauth' },
      { label: 'â†’ Auth0 (Lv.3)', href: '/cycle/auth/auth0' },
      { label: 'â†’ Firebase (Lv.2)', href: '/cycle/auth/firebase' },
    ],
  },
  {
    title: 'Agent Recipes',
    items: [
      { label: 'Core Pack (10ê°œ)', href: '/agent-recipes' },
    ],
  },
  {
    title: 'ë°°í¬ ë ˆí¼ëŸ°ìŠ¤',
    items: [
      { label: 'Cloudflare Pages', href: '/deploy/cloudflare-pages' },
      { label: 'Vercel', href: '/deploy/vercel' },
      { label: 'Cloud Run', href: '/deploy/cloud-run' },
    ],
  },
  {
    title: 'íŠ¸ëŸ¬ë¸”ìŠˆíŒ…',
    items: [
      { label: 'CORS ì—ëŸ¬', href: '/troubleshooting/cors' },
      { label: 'í™˜ê²½ ë³€ìˆ˜', href: '/troubleshooting/env' },
      { label: 'SPA 404', href: '/troubleshooting/spa-404' },
      { label: 'ë¹Œë“œ ì‹¤íŒ¨', href: '/troubleshooting/build-fail' },
      { label: 'ì¸ì¦/ì¿ í‚¤', href: '/troubleshooting/auth-cookie' },
    ],
  },
];
---

<BaseLayout title={title} description={description}>
  <div class="min-h-screen flex flex-col">
    <!-- í—¤ë” -->
    <header class="sticky top-0 z-50 border-b border-border bg-background/80 backdrop-blur-md">
      <div class="max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-14">
          <div class="flex items-center gap-4">
            <a href="/" class="flex items-center gap-2" aria-label="Choorai í™ˆ">
              <img src="/favicon.png" alt="" class="w-7 h-7" aria-hidden="true" />
              <span class="text-lg font-bold">Choorai</span>
            </a>
            <span class="text-border">|</span>
            <span class="text-sm text-text-secondary">ë¬¸ì„œ</span>
          </div>

          <div class="flex items-center gap-4">
            <!-- ê²€ìƒ‰ -->
            <button
              id="search-trigger"
              class="hidden md:flex items-center h-9 w-64 rounded-lg border border-border bg-surface px-3 hover:border-primary/50 transition-colors cursor-pointer"
              aria-label="ë¬¸ì„œ ê²€ìƒ‰ ì—´ê¸°"
            >
              <svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
              <span class="flex-1 text-left text-sm text-text-secondary px-2">ë¬¸ì„œ ê²€ìƒ‰...</span>
              <kbd class="text-[10px] text-text-secondary bg-background px-1.5 py-0.5 rounded border border-border" aria-hidden="true">âŒ˜K</kbd>
            </button>

            <a href="https://github.com/curogom/choorai" class="text-text-secondary hover:text-white transition-colors" aria-label="GitHub ì €ì¥ì†Œ">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" />
              </svg>
            </a>
          </div>
        </div>
      </div>
    </header>

    <div class="flex-1 flex">
      <!-- ì‚¬ì´ë“œë°” -->
      <aside class="hidden lg:block w-64 border-r border-border bg-background sticky top-14 h-[calc(100vh-3.5rem)] overflow-y-auto" role="navigation" aria-label="ë¬¸ì„œ ë„¤ë¹„ê²Œì´ì…˜">
        <nav class="p-4 space-y-6">
          {navigation.map((section) => (
            <div>
              <h3 class="text-xs font-bold text-text-secondary uppercase tracking-wider mb-2 px-3">
                {section.title}
              </h3>
              <ul class="space-y-1">
                {section.items.map((item) => (
                  <li>
                    <a
                      href={item.href}
                      class={`
                        flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium
                        transition-colors
                        ${currentPath === item.href
                          ? 'bg-primary/10 text-primary border-l-2 border-primary -ml-[1px]'
                          : 'text-text-secondary hover:text-white hover:bg-surface'
                        }
                      `}
                    >
                      {item.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </nav>
      </aside>

      <!-- ë©”ì¸ ì½˜í…ì¸  -->
      <main class="flex-1 min-w-0">
        <slot />
      </main>
    </div>
  </div>

  <!-- ê²€ìƒ‰ ëª¨ë‹¬ -->
  <div id="search-modal" class="fixed inset-0 z-[100] hidden" role="dialog" aria-modal="true" aria-label="ë¬¸ì„œ ê²€ìƒ‰">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" id="search-overlay" aria-hidden="true"></div>
    <div class="relative max-w-2xl mx-auto mt-20 bg-background border border-border rounded-xl shadow-2xl overflow-hidden">
      <div class="p-4">
        <div id="pagefind-container"></div>
      </div>
    </div>
  </div>

  <script>
    // Pagefind ì´ˆê¸°í™”
    async function initSearch() {
      const link = document.createElement('link');
      link.rel = 'stylesheet';
      link.href = '/pagefind/pagefind-ui.css';
      document.head.appendChild(link);

      const style = document.createElement('style');
      style.textContent = `
        .pagefind-ui { --pagefind-ui-scale: 1; --pagefind-ui-primary: #57ABFF; --pagefind-ui-text: #fff; --pagefind-ui-background: #161B22; --pagefind-ui-border: #30363D; --pagefind-ui-tag: #21262D; --pagefind-ui-border-width: 1px; --pagefind-ui-border-radius: 8px; }
        .pagefind-ui__search-input { background: #0D1117 !important; }
        .pagefind-ui__result-link { color: #57ABFF !important; }
        .pagefind-ui__result-excerpt { color: #8B949E !important; }
      `;
      document.head.appendChild(style);

      const script = document.createElement('script');
      script.src = '/pagefind/pagefind-ui.js';
      script.onload = () => {
        // @ts-ignore
        new PagefindUI({
          element: '#pagefind-container',
          showSubResults: true,
          showImages: false,
          translations: { placeholder: 'ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...', zero_results: 'ê²°ê³¼ ì—†ìŒ', many_results: '[COUNT]ê°œ ê²°ê³¼', one_result: '1ê°œ ê²°ê³¼' }
        });
      };
      document.head.appendChild(script);
    }

    // ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
    const modal = document.getElementById('search-modal');
    const trigger = document.getElementById('search-trigger');
    const overlay = document.getElementById('search-overlay');

    function openSearch() {
      modal?.classList.remove('hidden');
      setTimeout(() => (document.querySelector('.pagefind-ui__search-input') as HTMLElement)?.focus(), 100);
    }
    function closeSearch() { modal?.classList.add('hidden'); }

    trigger?.addEventListener('click', openSearch);
    overlay?.addEventListener('click', closeSearch);
    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'k') { e.preventDefault(); openSearch(); }
      if (e.key === 'Escape') closeSearch();
    });

    initSearch();
  </script>
</BaseLayout>
