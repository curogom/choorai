---
import DocsLayout from '../../layouts/DocsLayout.astro';
import Callout from '../../components/Callout';
import CodeBlock from '../../components/CodeBlock';
import PromptBox from '../../components/PromptBox';
import Checklist from '../../components/Checklist';

const prompt = `FastAPI 프로젝트를 Google Cloud Run에 배포하려고 해.
아래 정보 기준으로 실행 가능한 배포 절차를 작성해줘.

[입력 정보]
- 프로젝트 루트: [PROJECT_PATH]
- 서비스 이름: [SERVICE_NAME]
- GCP 프로젝트 ID: [GCP_PROJECT_ID]
- 리전: [REGION]
- 인증 여부: [ALLOW_UNAUTH]
- 환경변수 목록: [ENV_LIST]

[출력 요구사항]
1) Dockerfile 점검 포인트
2) gcloud 명령 순서
3) 운영 최소 설정(max instances, health endpoint, timeout)
4) 배포 후 검증 시나리오
5) 실패 시 롤백/재배포 절차`;

const checklist = [
  { id: 'gcloud', label: 'gcloud 인증/프로젝트 설정', description: 'gcloud auth login 및 project 지정' },
  { id: 'docker', label: 'Dockerfile/헬스체크 확인', description: 'PORT, startup command 검증' },
  { id: 'deploy', label: 'Cloud Run 배포 명령 실행', description: '서비스 URL 발급 확인' },
  { id: 'env', label: '환경변수/시크릿 주입', description: '런타임 변수 누락 확인' },
  { id: 'verify', label: '헬스/주요 API 검증', description: '응답 코드/지연시간 체크' },
];
---

<DocsLayout
  title="레시피: Cloud Run 배포"
  description="AI 에이전트로 FastAPI Cloud Run 배포를 빠르게 진행하는 프롬프트 레시피"
  currentPath="/recipes/deploy-cloud-run"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="현재 위치">
      <a href="/" class="hover:text-white transition-colors">홈</a>
      <span>/</span>
      <a href="/recipes" class="hover:text-white transition-colors">Recipes</a>
      <span>/</span>
      <span class="text-primary font-medium">Cloud Run 배포</span>
    </nav>

    <header class="mb-8 pb-6 border-b border-border">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-purple-500/10 text-purple-300 text-xs font-bold mb-4">
        Recipes Core Pack · Deploy
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">Cloud Run 배포 레시피</h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        Dockerfile 점검부터 운영 기본값까지 포함한 Cloud Run 배포 프롬프트입니다.
      </p>
    </header>

    <section class="mb-8">
      <Callout client:load variant="tip" title="사용 방법">
        <p class="mt-2">
          프롬프트 복사 후 서비스 이름/프로젝트 ID/리전만 바꿔 실행하면 됩니다.
        </p>
      </Callout>
    </section>

    <section class="mb-10">
      <PromptBox client:load prompt={prompt} title="Cloud Run 배포 프롬프트" />
    </section>

    <section class="mb-10">
      <h2 class="text-2xl font-bold text-white mb-4">명령어 예시</h2>
      <CodeBlock
        client:load
        filename="terminal"
        code={`gcloud auth login

gcloud config set project my-project-id

gcloud run deploy my-api \\
  --source . \\
  --region asia-northeast3 \\
  --allow-unauthenticated \\
  --max-instances 3`}
      />
    </section>

    <section class="mb-10">
      <Checklist
        client:load
        storageKey="recipe-deploy-cloud-run"
        title="실행 체크리스트"
        items={checklist}
      />
    </section>

    <section class="mt-12 pt-8 border-t border-border">
      <h3 class="text-lg font-bold text-white mb-4">관련 문서</h3>
      <div class="grid md:grid-cols-2 gap-4">
        <a href="/deploy/cloud-run" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">Cloud Run 배포 가이드</h4>
          <p class="text-text-secondary text-sm">기본 배포 플로우</p>
        </a>
        <a href="/fix/gateway-timeout" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">502/504 Timeout 해결</h4>
          <p class="text-text-secondary text-sm">런타임 타임아웃 점검</p>
        </a>
      </div>
    </section>
  </div>
</DocsLayout>
