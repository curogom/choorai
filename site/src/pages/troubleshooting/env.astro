---
import DocsLayout from '../../layouts/DocsLayout.astro';
import ErrorCard from '../../components/ErrorCard';
import CodeBlock from '../../components/CodeBlock';
import Callout from '../../components/Callout';
---

<DocsLayout
  title="환경 변수 에러 해결하기"
  description="process.env.XXX is undefined 에러 해결 방법"
  currentPath="/troubleshooting/env"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="현재 위치">
      <a href="/" class="hover:text-white transition-colors">홈</a>
      <span>/</span>
      <a href="/troubleshooting" class="hover:text-white transition-colors">트러블슈팅</a>
      <span>/</span>
      <span class="text-primary font-medium">환경 변수</span>
    </nav>

    <header class="mb-8 pb-6 border-b border-border">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-warning/10 text-warning text-xs font-bold mb-4">
        자주 발생하는 에러
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        환경 변수 에러 해결하기
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        "process.env.API_KEY is undefined" 에러가 발생했나요?
        환경 변수가 제대로 설정되지 않았을 때 발생합니다.
      </p>
    </header>

    <section class="mb-8">
      <Callout client:load variant="tip" title="TL;DR (핵심 요약)">
        <p class="mt-2">
          1) <code class="bg-surface px-1 rounded">.env</code> 파일 생성
          2) 변수 앞에 <code class="bg-surface px-1 rounded">VITE_</code> 또는 <code class="bg-surface px-1 rounded">NEXT_PUBLIC_</code> 접두사 추가
          3) 서버 재시작
        </p>
      </Callout>
    </section>

    <section class="mb-8 space-y-6">
      <ErrorCard
        client:load
        errorMessage="process.env.API_KEY is undefined"
        severity="warning"
        cause="환경 변수가 설정되지 않았거나, 프론트엔드에서 접근 불가능한 변수를 사용했습니다."
        solution={[
          "프로젝트 루트에 .env 파일을 생성하세요",
          "Vite: 변수명 앞에 VITE_ 접두사를 붙이세요",
          "Next.js: 변수명 앞에 NEXT_PUBLIC_ 접두사를 붙이세요",
          "서버를 재시작하세요"
        ]}
        aiPrompt="Vite 프로젝트에서 환경 변수가 undefined로 나와. .env 파일은 만들었는데 왜 그런지 모르겠어."
      />
    </section>

    <article class="prose prose-invert max-w-none">
      <h2 class="text-2xl font-bold text-white mb-4">프레임워크별 설정 방법</h2>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
          <span class="px-2 py-0.5 rounded bg-purple-500/20 text-purple-400 text-xs font-bold">Vite</span>
          React + Vite
        </h3>
        <CodeBlock
          client:load
          filename=".env"
          code={`# 프론트엔드에서 접근 가능 (VITE_ 접두사 필수!)
VITE_API_URL=https://api.example.com
VITE_PUBLIC_KEY=pk_test_xxx

# 프론트엔드에서 접근 불가 (서버 전용)
DATABASE_URL=postgres://...
SECRET_KEY=your-secret`}
        />
        <p class="text-text-secondary text-sm mt-3">
          사용법: <code class="bg-surface px-1 rounded">import.meta.env.VITE_API_URL</code>
        </p>
      </section>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
          <span class="px-2 py-0.5 rounded bg-black text-white text-xs font-bold">Next.js</span>
        </h3>
        <CodeBlock
          client:load
          filename=".env.local"
          code={`# 프론트엔드에서 접근 가능 (NEXT_PUBLIC_ 접두사 필수!)
NEXT_PUBLIC_API_URL=https://api.example.com

# 서버 전용
DATABASE_URL=postgres://...`}
        />
        <p class="text-text-secondary text-sm mt-3">
          사용법: <code class="bg-surface px-1 rounded">process.env.NEXT_PUBLIC_API_URL</code>
        </p>
      </section>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
          <span class="px-2 py-0.5 rounded bg-green-500/20 text-green-400 text-xs font-bold">Python</span>
          FastAPI
        </h3>
        <CodeBlock
          client:load
          filename=".env"
          code={`DATABASE_URL=postgres://user:pass@localhost/db
SECRET_KEY=your-secret-key
DEBUG=true`}
        />
        <CodeBlock
          client:load
          filename="config.py"
          code={`from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    database_url: str
    secret_key: str
    debug: bool = False

    class Config:
        env_file = ".env"

settings = Settings()`}
        />
      </section>

      <section class="mb-8">
        <Callout client:load variant="warning" title=".gitignore에 추가하세요!">
          <p class="mt-2">
            <code class="bg-surface px-1 rounded">.env</code> 파일에는 민감한 정보가 들어갑니다.
            반드시 <code class="bg-surface px-1 rounded">.gitignore</code>에 추가해서 GitHub에 업로드되지 않도록 하세요.
          </p>
        </Callout>
        <CodeBlock
          client:load
          filename=".gitignore"
          code={`# 환경 변수 파일
.env
.env.local
.env.*.local`}
        />
      </section>
    </article>

    <section class="mt-12 pt-8 border-t border-border">
      <h3 class="text-lg font-bold text-white mb-4">관련 문서</h3>
      <div class="grid md:grid-cols-2 gap-4">
        <a href="/troubleshooting/build-fail" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">빌드 실패</h4>
          <p class="text-text-secondary text-sm">npm run build 에러</p>
        </a>
        <a href="/troubleshooting/cors" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">CORS 에러</h4>
          <p class="text-text-secondary text-sm">API 호출 시 CORS 문제</p>
        </a>
      </div>
    </section>
  </div>
</DocsLayout>
