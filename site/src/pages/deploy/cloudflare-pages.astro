---
import DocsLayout from '../../layouts/DocsLayout.astro';
import Callout from '../../components/Callout';
import CodeBlock from '../../components/CodeBlock';
import Checklist from '../../components/Checklist';
import SectionHeader from '../../components/SectionHeader';
import MetaBadge from '../../components/MetaBadge';
import PageNavigation from '../../components/PageNavigation.astro';

const deployChecklist = [
  { id: 'github', label: 'GitHub에 코드 푸시', description: 'git push origin main' },
  { id: 'cloudflare', label: 'Cloudflare 계정 생성', description: 'dash.cloudflare.com' },
  { id: 'connect', label: 'GitHub 연결', description: 'Cloudflare Pages에서 연동' },
  { id: 'deploy', label: '배포 완료', description: '자동 배포 확인' },
  { id: 'domain', label: '커스텀 도메인 (선택)', description: '나만의 도메인 연결' },
];
---

<DocsLayout
  title="Cloudflare Pages 배포 가이드"
  description="React/Vite 앱을 Cloudflare Pages에 무료로 배포하는 방법"
  currentPath="/deploy/cloudflare-pages"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="현재 위치">
      <a href="/" class="hover:text-white transition-colors">홈</a>
      <span>/</span>
      <a href="/deploy" class="hover:text-white transition-colors">배포</a>
      <span>/</span>
      <span class="text-primary font-medium">Cloudflare Pages</span>
    </nav>

    <header class="mb-8 pb-6 border-b border-border">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-orange-500/10 text-orange-400 text-xs font-bold mb-4">
        무료 호스팅
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        Cloudflare Pages로 배포하기
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        React, Vue, Astro 등의 프론트엔드 앱을 무료로 배포할 수 있습니다.
        GitHub 연동으로 푸시할 때마다 자동 배포됩니다.
      </p>
    </header>

    <section class="mb-8">
      <Callout client:load variant="tip" title="왜 Cloudflare Pages?">
        <ul class="list-disc list-inside space-y-1 mt-2">
          <li>무료 (무제한 요청, 무제한 대역폭)</li>
          <li>전 세계 CDN으로 빠른 속도</li>
          <li>자동 HTTPS</li>
          <li>GitHub 연동으로 자동 배포</li>
        </ul>
      </Callout>
    </section>

    <article class="prose prose-invert max-w-none">
      <!-- Step 1 -->
      <section class="mb-10">
        <SectionHeader number={1} title="GitHub에 코드 올리기" />

        <p class="text-text-secondary mb-4">
          배포할 코드가 GitHub 저장소에 있어야 합니다.
        </p>

        <CodeBlock
          client:load
          code={`# 저장소 초기화 (처음인 경우)
git init

# 파일 추가
git add .

# 커밋
git commit -m "Initial commit"

# GitHub 저장소 연결 (처음인 경우)
git remote add origin https://github.com/username/my-project.git

# 푸시
git push -u origin main`}
          filename="터미널"
        />

        <Callout client:load variant="info">
          <p>
            GitHub 저장소가 없다면 <a href="https://github.com/new" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">github.com/new</a>에서 생성하세요.
          </p>
        </Callout>
      </section>

      <!-- Step 2 -->
      <section class="mb-10">
        <SectionHeader number={2} title="Cloudflare Pages 설정" />

        <ol class="list-decimal list-inside text-text-secondary space-y-4">
          <li>
            <a href="https://dash.cloudflare.com/sign-up" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">
              Cloudflare 가입
            </a> (무료)
          </li>
          <li>대시보드에서 <strong class="text-white">Workers & Pages</strong> 클릭</li>
          <li><strong class="text-white">Create application</strong> → <strong class="text-white">Pages</strong> 선택</li>
          <li><strong class="text-white">Connect to Git</strong> 클릭</li>
          <li>GitHub 계정 연결 및 저장소 선택</li>
        </ol>

        <div class="mt-6 p-4 bg-surface border border-border rounded-xl">
          <h3 class="text-white font-bold mb-3">빌드 설정 (프레임워크별)</h3>

          <div class="space-y-4">
            <div>
              <h4 class="text-sm font-bold text-primary mb-2">React + Vite</h4>
              <ul class="text-text-secondary text-sm space-y-1">
                <li>Build command: <code class="bg-background px-1 rounded">npm run build</code></li>
                <li>Build output: <code class="bg-background px-1 rounded">dist</code></li>
              </ul>
            </div>

            <div>
              <h4 class="text-sm font-bold text-primary mb-2">Next.js</h4>
              <ul class="text-text-secondary text-sm space-y-1">
                <li>Build command: <code class="bg-background px-1 rounded">npx @cloudflare/next-on-pages@1</code></li>
                <li>Build output: <code class="bg-background px-1 rounded">.vercel/output/static</code></li>
              </ul>
            </div>

            <div>
              <h4 class="text-sm font-bold text-primary mb-2">Astro</h4>
              <ul class="text-text-secondary text-sm space-y-1">
                <li>Build command: <code class="bg-background px-1 rounded">npm run build</code></li>
                <li>Build output: <code class="bg-background px-1 rounded">dist</code></li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Step 3 -->
      <section class="mb-10">
        <SectionHeader number={3} title="SPA 라우팅 설정" />

        <p class="text-text-secondary mb-4">
          React Router 등을 사용하는 SPA는 추가 설정이 필요합니다.
          새로고침 시 404 에러를 방지합니다.
        </p>

        <CodeBlock
          client:load
          code="/* /index.html 200"
          filename="public/_redirects"
        />

        <p class="text-text-secondary text-sm mt-2">
          이 파일을 <code class="bg-surface px-1 rounded">public</code> 폴더에 생성하세요.
        </p>

        <Callout client:load variant="warning" title="이 설정을 안 하면?">
          <p class="mt-2">
            <code class="bg-surface px-1 rounded">/about</code> 같은 페이지에서 새로고침하면 404가 뜹니다.
            자세한 내용은 <a href="/troubleshooting/spa-404" class="text-primary hover:underline">SPA 404 에러 해결</a>을 참고하세요.
          </p>
        </Callout>
      </section>

      <!-- Step 4 -->
      <section class="mb-10">
        <SectionHeader number={4} title="환경 변수 설정 (필요시)" />

        <p class="text-text-secondary mb-4">
          API 키 등 민감한 정보는 환경 변수로 설정합니다.
        </p>

        <ol class="list-decimal list-inside text-text-secondary space-y-2 mb-4">
          <li>Cloudflare 대시보드 → 프로젝트 선택</li>
          <li><strong class="text-white">Settings</strong> → <strong class="text-white">Environment variables</strong></li>
          <li>변수 추가 (예: <code class="bg-surface px-1 rounded">VITE_API_URL</code>)</li>
          <li>Production/Preview 환경 구분 가능</li>
        </ol>

        <Callout client:load variant="info">
          <p>
            Vite를 사용하는 경우, 환경 변수 이름이 <code class="bg-surface px-1 rounded">VITE_</code>로 시작해야 합니다.
            자세한 내용은 <a href="/troubleshooting/env" class="text-primary hover:underline">환경 변수 에러 해결</a>을 참고하세요.
          </p>
        </Callout>
      </section>

      <!-- Step 5 -->
      <section class="mb-10">
        <SectionHeader number={5} title="커스텀 도메인 연결 (선택)" />

        <p class="text-text-secondary mb-4">
          기본으로 <code class="bg-surface px-1 rounded">프로젝트명.pages.dev</code> 도메인이 제공됩니다.
          나만의 도메인을 사용하려면 추가 설정이 필요합니다.
        </p>

        <ol class="list-decimal list-inside text-text-secondary space-y-2 mb-4">
          <li>프로젝트 → <strong class="text-white">Custom domains</strong></li>
          <li><strong class="text-white">Set up a custom domain</strong> 클릭</li>
          <li>도메인 입력 (예: <code class="bg-surface px-1 rounded">myapp.com</code>)</li>
          <li>DNS 설정 안내에 따라 설정</li>
        </ol>

        <Callout client:load variant="tip">
          <p>
            도메인을 Cloudflare DNS에서 관리하면 자동으로 연결됩니다.
            다른 DNS를 사용하면 CNAME 레코드를 추가해야 합니다.
          </p>
        </Callout>
      </section>

      <!-- 체크리스트 -->
      <section class="mb-10">
        <Checklist
          client:load
          storageKey="deploy-cloudflare"
          title="배포 완료 체크리스트"
          items={deployChecklist}
        />
      </section>

      <!-- 배포 후 -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">배포 완료!</h2>

        <div class="p-6 bg-success/10 border border-success/30 rounded-xl">
          <div class="flex items-center gap-3 mb-4">
            <svg class="w-8 h-8 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="text-white font-bold text-xl">축하합니다!</h3>
          </div>
          <p class="text-text-secondary">
            이제 코드를 GitHub에 푸시할 때마다 자동으로 배포됩니다.
            <code class="bg-background px-1 rounded">프로젝트명.pages.dev</code>에서 확인하세요.
          </p>
        </div>
      </section>
    </article>

    <PageNavigation currentPath="/deploy/cloudflare-pages" />
  </div>
</DocsLayout>
