---
import DocsLayout from '../../layouts/DocsLayout.astro';
import Callout from '../../components/Callout';
import CodeBlock from '../../components/CodeBlock';
import PageNavigation from '../../components/PageNavigation.astro';
---

<DocsLayout
  title="HTTP/API 기초"
  description="초심자를 위한 API 통신 핵심 개념: endpoint, method, status code, JSON"
  currentPath="/map/http-api"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <h1 class="text-3xl font-black text-white mb-4">HTTP/API 기초</h1>
    <p class="text-text-secondary mb-6">프론트엔드와 백엔드가 어떻게 대화하는지, 실무에서 자주 보는 용어를 빠르게 이해합니다.</p>

    <Callout client:load variant="tip" title="핵심 5개">
      <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
        <li><strong>Endpoint</strong>: API가 요청을 받는 URL 경로</li>
        <li><strong>Method</strong>: GET/POST/PUT/DELETE 같은 요청 동작</li>
        <li><strong>Request/Response</strong>: 요청 데이터와 응답 데이터</li>
        <li><strong>Status Code</strong>: 200, 400, 500 등 처리 결과 숫자</li>
        <li><strong>JSON</strong>: 데이터 교환 형식</li>
      </ul>
    </Callout>

    <article class="prose prose-invert max-w-none mt-8">
      <h2 class="text-2xl font-bold text-white mb-3">요청 1번의 실제 흐름</h2>
      <ol class="list-decimal list-inside text-text-secondary space-y-1 mb-6">
        <li>브라우저에서 <code>/api/v1/todos</code>로 요청</li>
        <li>서버가 인증/검증 후 비즈니스 로직 실행</li>
        <li>서버가 상태코드 + JSON으로 응답</li>
        <li>프론트엔드가 응답을 해석해 화면 업데이트</li>
      </ol>

      <h2 class="text-2xl font-bold text-white mb-3">상태코드 빠른 해석</h2>
      <ul class="list-disc list-inside text-text-secondary space-y-1 mb-6">
        <li><code>200</code>: 조회/수정 성공</li>
        <li><code>201</code>: 생성 성공</li>
        <li><code>204</code>: 성공했지만 본문 없음</li>
        <li><code>400</code>: 잘못된 요청 형식</li>
        <li><code>401/403</code>: 인증/권한 문제</li>
        <li><code>404</code>: 경로 또는 리소스 없음</li>
        <li><code>500</code>: 서버 내부 오류</li>
      </ul>

      <h2 class="text-2xl font-bold text-white mb-3">실전 예시: 조회와 생성</h2>
      <CodeBlock
        client:load
        filename="터미널 (curl)"
        code={`# 목록 조회
curl -X GET http://localhost:8000/api/v1/todos

# 항목 생성
curl -X POST http://localhost:8000/api/v1/todos \\
  -H "Content-Type: application/json" \\
  -d '{"title":"문서 보강"}'`}
      />

      <h2 class="text-2xl font-bold text-white mb-3">실전 예시: 프론트에서 호출</h2>
      <CodeBlock
        client:load
        filename="frontend/api.ts"
        code={`export async function fetchTodos() {
  const res = await fetch('/api/v1/todos');
  if (!res.ok) throw new Error('요청 실패');
  return res.json();
}

export async function createTodo(title: string) {
  const res = await fetch('/api/v1/todos', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ title }),
  });
  if (!res.ok) throw new Error('생성 실패');
  return res.json();
}`}
      />

      <h2 class="text-2xl font-bold text-white mb-3">60분 챌린지에서 쓰는 지점</h2>
      <ul class="list-disc list-inside text-text-secondary space-y-1 mb-6">
        <li><a href="/start/60min/backend/hono" class="text-primary hover:underline">백엔드 단계</a>: 엔드포인트 작성</li>
        <li><a href="/start/60min/connect" class="text-primary hover:underline">연결 단계</a>: 프론트에서 API 호출</li>
        <li><a href="/start/60min/deploy" class="text-primary hover:underline">배포 단계</a>: 실서버 URL로 전환</li>
      </ul>

      <h2 class="text-2xl font-bold text-white mb-3">초심자 실수 TOP 3</h2>
      <ul class="list-disc list-inside text-text-secondary space-y-1 mb-6">
        <li>경로를 <code>/api/todo</code> vs <code>/api/todos</code>처럼 다르게 호출</li>
        <li><code>Content-Type: application/json</code> 헤더 누락</li>
        <li>에러 상태코드인데도 무조건 <code>res.json()</code>만 호출</li>
      </ul>

      <Callout client:load variant="info" title="디버깅 체크리스트">
        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
          <li>브라우저 네트워크 탭에서 URL/Method/Status를 먼저 확인</li>
          <li>요청 본문(JSON)과 서버 스키마가 일치하는지 확인</li>
          <li>CORS 에러라면 <a href="/map/cors-basics" class="text-primary hover:underline">CORS 기초</a>로 이동</li>
          <li>실전 에러 해결은 <a href="/fix/cors" class="text-primary hover:underline">트러블슈팅</a> 참고</li>
        </ul>
      </Callout>
    </article>

    <PageNavigation currentPath="/map/http-api" />
  </div>
</DocsLayout>
