---
import DocsLayout from '../../../layouts/DocsLayout.astro';
import Callout from '../../../components/Callout';
import CodeBlock from '../../../components/CodeBlock';
---

<DocsLayout
  title="NestJS - Lv.4 실무 백엔드"
  description="엔터프라이즈급 Node.js 백엔드 구조 배우기"
  currentPath="/map/backend/nest"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="현재 위치">
      <a href="/" class="hover:text-white transition-colors">홈</a>
      <span>/</span>
      <a href="/map/backend" class="hover:text-white transition-colors">Backend 배포</a>
      <span>/</span>
      <span class="text-primary font-medium">NestJS</span>
    </nav>

    <header class="mb-8 pb-6 border-b border-border">
      <div class="flex items-center gap-2 mb-4">
        <span class="px-3 py-1 rounded-full bg-purple-500/10 text-purple-400 text-xs font-bold">Lv.4 실무</span>
        <span class="px-3 py-1 rounded-full bg-surface text-text-secondary text-xs">Node.js</span>
        <span class="px-3 py-1 rounded-full bg-surface text-text-secondary text-xs">TypeScript</span>
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        NestJS로 실무 구조 배우기
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        NestJS는 Angular에서 영감을 받은 엔터프라이즈급 Node.js 프레임워크입니다.
        모듈, 의존성 주입, 데코레이터 패턴을 사용합니다.
      </p>
    </header>

    <section class="mb-10">
      <Callout client:load variant="warning" title="Hono를 먼저 해보세요">
        <p class="mt-2 text-sm">
          NestJS는 구조가 복잡합니다. 백엔드가 처음이라면
          <a href="/map/backend/hono" class="text-primary hover:underline">Hono (Lv.1)</a>부터 시작하세요.
        </p>
      </Callout>
    </section>

    <article class="prose prose-invert max-w-none">
      <!-- 왜 NestJS인가 -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">왜 NestJS인가?</h2>

        <div class="grid md:grid-cols-2 gap-4">
          <div class="p-4 bg-green-500/10 border border-green-500/30 rounded-xl">
            <h3 class="text-white font-bold mb-2">👍 장점</h3>
            <ul class="text-text-secondary text-sm space-y-1">
              <li>• 명확한 구조 (모듈/컨트롤러/서비스)</li>
              <li>• 의존성 주입 (DI) 지원</li>
              <li>• 채용 시장에서 인기</li>
              <li>• 대규모 팀에 적합</li>
            </ul>
          </div>
          <div class="p-4 bg-red-500/10 border border-red-500/30 rounded-xl">
            <h3 class="text-white font-bold mb-2">👎 단점</h3>
            <ul class="text-text-secondary text-sm space-y-1">
              <li>• 학습 곡선이 가파름</li>
              <li>• 보일러플레이트 코드 많음</li>
              <li>• 작은 프로젝트에는 과함</li>
              <li>• 데코레이터 문법 익숙해야 함</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- 프로젝트 구조 -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">프로젝트 구조</h2>

        <p class="text-text-secondary mb-4">
          NestJS는 <strong class="text-white">모듈 기반</strong> 아키텍처를 사용합니다.
          각 기능은 모듈로 분리되고, 모듈은 컨트롤러와 서비스로 구성됩니다.
        </p>

        <CodeBlock
          client:load
          code={`src/
├── main.ts                    # 진입점
├── app.module.ts              # 루트 모듈
├── health/
│   ├── health.module.ts       # 헬스 모듈
│   └── health.controller.ts   # 헬스 컨트롤러
└── projects/
    ├── projects.module.ts     # 프로젝트 모듈
    ├── projects.controller.ts # 라우팅 담당
    ├── projects.service.ts    # 비즈니스 로직
    └── dto/
        ├── create-project.dto.ts
        └── update-project.dto.ts`}
          filename="프로젝트 구조"
        />

        <div class="mt-4 p-4 bg-surface border border-border rounded-xl">
          <h4 class="text-white font-bold mb-2">핵심 개념</h4>
          <ul class="text-text-secondary text-sm space-y-2">
            <li><strong class="text-blue-400">Module</strong>: 관련 기능을 묶는 단위. imports/exports로 의존성 관리</li>
            <li><strong class="text-green-400">Controller</strong>: HTTP 요청 처리. 라우팅과 응답 담당</li>
            <li><strong class="text-purple-400">Service</strong>: 비즈니스 로직. 컨트롤러에 주입됨</li>
            <li><strong class="text-yellow-400">DTO</strong>: 데이터 전송 객체. 입력 검증에 사용</li>
          </ul>
        </div>
      </section>

      <!-- 코드 예제 -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">코드 예제</h2>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">1. 메인 진입점</h3>

        <CodeBlock
          client:load
          code={`import { NestFactory } from '@nestjs/core';
import { ValidationPipe } from '@nestjs/common';
import { AppModule } from './app.module';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  // CORS 설정
  app.enableCors({
    origin: ['http://localhost:5173'],
    credentials: true,
  });

  // 전역 검증 파이프
  app.useGlobalPipes(new ValidationPipe({
    whitelist: true,
    transform: true,
  }));

  await app.listen(8000);
  console.log('🚀 NestJS running on http://localhost:8000');
}

bootstrap();`}
          filename="src/main.ts"
        />

        <h3 class="text-lg font-bold text-white mt-6 mb-3">2. 루트 모듈</h3>

        <CodeBlock
          client:load
          code={`import { Module } from '@nestjs/common';
import { HealthModule } from './health/health.module';
import { ProjectsModule } from './projects/projects.module';

@Module({
  imports: [HealthModule, ProjectsModule],
})
export class AppModule {}`}
          filename="src/app.module.ts"
        />

        <h3 class="text-lg font-bold text-white mt-6 mb-3">3. DTO (입력 검증)</h3>

        <CodeBlock
          client:load
          code={`import { IsString, IsOptional, MinLength, MaxLength } from 'class-validator';

export class CreateProjectDto {
  @IsString()
  @MinLength(1)
  @MaxLength(100)
  name: string;

  @IsOptional()
  @IsString()
  @MaxLength(500)
  description?: string;
}`}
          filename="src/projects/dto/create-project.dto.ts"
        />

        <h3 class="text-lg font-bold text-white mt-6 mb-3">4. 컨트롤러</h3>

        <CodeBlock
          client:load
          code={`import { Controller, Get, Post, Body, Param, Delete, HttpCode } from '@nestjs/common';
import { ProjectsService } from './projects.service';
import { CreateProjectDto } from './dto/create-project.dto';

@Controller('api/v1/projects')  // 라우트 프리픽스
export class ProjectsController {
  // 의존성 주입
  constructor(private readonly projectsService: ProjectsService) {}

  @Post()
  @HttpCode(201)
  create(@Body() createProjectDto: CreateProjectDto) {
    return this.projectsService.create(createProjectDto);
  }

  @Get()
  findAll() {
    return this.projectsService.findAll();
  }

  @Get(':id')
  findOne(@Param('id') id: string) {
    return this.projectsService.findOne(id);
  }

  @Delete(':id')
  @HttpCode(204)
  remove(@Param('id') id: string) {
    return this.projectsService.remove(id);
  }
}`}
          filename="src/projects/projects.controller.ts"
        />

        <h3 class="text-lg font-bold text-white mt-6 mb-3">5. 서비스</h3>

        <CodeBlock
          client:load
          code={`import { Injectable, NotFoundException } from '@nestjs/common';
import { CreateProjectDto } from './dto/create-project.dto';

@Injectable()  // DI 컨테이너에 등록
export class ProjectsService {
  private projects = new Map();

  create(dto: CreateProjectDto) {
    const project = {
      id: crypto.randomUUID(),
      name: dto.name,
      description: dto.description || null,
      created_at: new Date().toISOString(),
    };
    this.projects.set(project.id, project);
    return project;
  }

  findAll() {
    return {
      items: Array.from(this.projects.values()),
      total: this.projects.size,
    };
  }

  findOne(id: string) {
    const project = this.projects.get(id);
    if (!project) throw new NotFoundException('Project not found');
    return project;
  }

  remove(id: string) {
    if (!this.projects.delete(id)) {
      throw new NotFoundException('Project not found');
    }
  }
}`}
          filename="src/projects/projects.service.ts"
        />
      </section>

      <!-- Hono vs NestJS -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">Hono vs NestJS 비교</h2>

        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="border-b border-border">
                <th class="text-left p-3 text-text-secondary">항목</th>
                <th class="text-left p-3 text-green-400">Hono (Lv.1)</th>
                <th class="text-left p-3 text-purple-400">NestJS (Lv.4)</th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b border-border">
                <td class="p-3 text-text-secondary">파일 수</td>
                <td class="p-3 text-white">5개</td>
                <td class="p-3 text-white">12개</td>
              </tr>
              <tr class="border-b border-border">
                <td class="p-3 text-text-secondary">코드량</td>
                <td class="p-3 text-white">~150줄</td>
                <td class="p-3 text-white">~300줄</td>
              </tr>
              <tr class="border-b border-border">
                <td class="p-3 text-text-secondary">학습 곡선</td>
                <td class="p-3 text-white">낮음</td>
                <td class="p-3 text-white">높음</td>
              </tr>
              <tr class="border-b border-border">
                <td class="p-3 text-text-secondary">구조</td>
                <td class="p-3 text-white">자유로움</td>
                <td class="p-3 text-white">규칙적</td>
              </tr>
              <tr class="border-b border-border">
                <td class="p-3 text-text-secondary">팀 규모</td>
                <td class="p-3 text-white">1-3명</td>
                <td class="p-3 text-white">5명+</td>
              </tr>
              <tr>
                <td class="p-3 text-text-secondary">적합한 상황</td>
                <td class="p-3 text-white">빠른 프로토타입, 간단한 API</td>
                <td class="p-3 text-white">복잡한 도메인, 장기 유지보수</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- 예제 코드 -->
      <section class="mb-10">
        <Callout client:load variant="info" title="전체 예제 코드">
          <p class="text-sm mt-2">
            B2B Admin API의 NestJS 버전을 확인하세요:
            <a href="https://github.com/curogom/choorai/tree/main/examples/b2b-admin/api-nest" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline ml-1">
              examples/b2b-admin/api-nest
            </a>
          </p>
        </Callout>
      </section>

      <!-- 다음 단계 -->
      <section class="mb-10">
        <Callout client:load variant="tip" title="다음 단계">
          <p class="text-sm mt-2">
            백엔드 배포가 완료되었다면,
            <a href="/map/database" class="text-primary hover:underline">Cycle 4: 데이터베이스</a>에서
            PostgreSQL을 연결하는 방법을 배웁니다.
          </p>
        </Callout>
      </section>
    </article>

    <nav class="flex items-center justify-between pt-8 border-t border-border" aria-label="페이지 이동">
      <a
        href="/map/backend/hono"
        class="group flex items-center gap-3 px-4 py-2 rounded-lg border border-border hover:bg-surface transition-colors no-underline"
      >
        <svg class="w-5 h-5 text-text-secondary group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        <div class="text-left">
          <span class="text-xs text-text-secondary">이전</span>
          <span class="block text-sm text-white font-medium">Hono (Lv.1)</span>
        </div>
      </a>

      <a
        href="/map/database"
        class="group flex items-center gap-3 px-4 py-2 rounded-lg bg-primary hover:bg-primary-hover text-background transition-colors no-underline"
      >
        <div class="text-right">
          <span class="text-xs opacity-70">다음</span>
          <span class="block text-sm font-bold">Cycle 4: 데이터베이스</span>
        </div>
        <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </nav>
  </div>
</DocsLayout>
