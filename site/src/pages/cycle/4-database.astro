---
import DocsLayout from '../../layouts/DocsLayout.astro';
import Callout from '../../components/Callout';
import CodeBlock from '../../components/CodeBlock';
---

<DocsLayout
  title="Cycle 4: 데이터베이스 연결"
  description="PostgreSQL로 데이터를 영구 저장하는 방법"
  currentPath="/cycle/4-database"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6">
      <a href="/" class="hover:text-white transition-colors">홈</a>
      <span>/</span>
      <a href="/cycle/0-overview" class="hover:text-white transition-colors">학습 사이클</a>
      <span>/</span>
      <span class="text-primary font-medium">Cycle 4: 데이터베이스</span>
    </nav>

    <header class="mb-8 pb-6 border-b border-border">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-bold mb-4">
        🎯 Cycle 4
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        데이터베이스 연결
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        지금까지는 메모리에 데이터를 저장했습니다.
        서버를 재시작하면 데이터가 사라지죠.
        이제 PostgreSQL을 연결하여 데이터를 영구 저장해봅시다.
      </p>
    </header>

    <section class="mb-10">
      <Callout client:load variant="tip" title="이 Cycle에서 배우는 것">
        <ul class="list-disc list-inside space-y-1 mt-2">
          <li>PostgreSQL 설치 및 설정</li>
          <li>SQLAlchemy ORM 사용법</li>
          <li>데이터베이스 마이그레이션 (Alembic)</li>
          <li>환경별 설정 분리</li>
        </ul>
      </Callout>
    </section>

    <article class="prose prose-invert max-w-none">
      <!-- 왜 데이터베이스가 필요한가 -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">왜 데이터베이스가 필요한가요?</h2>

        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <div class="p-4 bg-red-500/10 border border-red-500/30 rounded-xl">
            <h3 class="text-white font-bold mb-2">❌ 인메모리 저장</h3>
            <ul class="text-text-secondary text-sm space-y-1">
              <li>서버 재시작 시 데이터 삭제</li>
              <li>서버 여러 대일 때 데이터 불일치</li>
              <li>메모리 부족 위험</li>
            </ul>
          </div>
          <div class="p-4 bg-green-500/10 border border-green-500/30 rounded-xl">
            <h3 class="text-white font-bold mb-2">✅ 데이터베이스 사용</h3>
            <ul class="text-text-secondary text-sm space-y-1">
              <li>영구적인 데이터 저장</li>
              <li>여러 서버에서 동일한 데이터</li>
              <li>효율적인 검색과 정렬</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- PostgreSQL 선택 이유 -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">왜 PostgreSQL인가요?</h2>

        <p class="text-text-secondary mb-4">
          여러 데이터베이스 중 PostgreSQL을 추천하는 이유:
        </p>

        <ul class="list-disc list-inside text-text-secondary space-y-2 mb-4">
          <li><strong class="text-white">무료 & 오픈소스</strong> - 라이선스 비용 없음</li>
          <li><strong class="text-white">검증된 안정성</strong> - 30년 이상의 역사</li>
          <li><strong class="text-white">클라우드 지원</strong> - 모든 클라우드에서 관리형 서비스 제공</li>
          <li><strong class="text-white">JSON 지원</strong> - NoSQL처럼 유연한 데이터 저장 가능</li>
        </ul>
      </section>

      <!-- 빠른 시작 -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">빠른 시작</h2>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">1. 의존성 설치</h3>

        <CodeBlock
          client:load
          code={`pip install sqlalchemy psycopg2-binary alembic`}
          filename="터미널"
        />

        <h3 class="text-lg font-bold text-white mt-6 mb-3">2. 데이터베이스 모델 정의</h3>

        <CodeBlock
          client:load
          code={`from sqlalchemy import Column, String, DateTime, Boolean
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.ext.declarative import declarative_base
import uuid
from datetime import datetime

Base = declarative_base()

class Project(Base):
    __tablename__ = "projects"

    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    name = Column(String(200), nullable=False)
    description = Column(String(1000))
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)`}
          filename="app/models/project.py"
        />
      </section>

      <!-- 클라우드 데이터베이스 옵션 -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">클라우드 데이터베이스 옵션</h2>

        <div class="grid md:grid-cols-3 gap-4">
          <a href="https://supabase.com" target="_blank" rel="noopener noreferrer" class="p-4 bg-surface border border-border rounded-xl hover:border-primary/50 transition-colors no-underline">
            <h3 class="text-white font-bold mb-2">Supabase</h3>
            <p class="text-text-secondary text-sm">무료 티어 제공, PostgreSQL 기반</p>
            <span class="text-primary text-xs mt-2 inline-block">추천 →</span>
          </a>
          <a href="https://neon.tech" target="_blank" rel="noopener noreferrer" class="p-4 bg-surface border border-border rounded-xl hover:border-primary/50 transition-colors no-underline">
            <h3 class="text-white font-bold mb-2">Neon</h3>
            <p class="text-text-secondary text-sm">서버리스 PostgreSQL</p>
            <span class="text-text-secondary text-xs mt-2 inline-block">자세히 →</span>
          </a>
          <a href="https://planetscale.com" target="_blank" rel="noopener noreferrer" class="p-4 bg-surface border border-border rounded-xl hover:border-primary/50 transition-colors no-underline">
            <h3 class="text-white font-bold mb-2">PlanetScale</h3>
            <p class="text-text-secondary text-sm">MySQL 기반, 브랜칭 지원</p>
            <span class="text-text-secondary text-xs mt-2 inline-block">자세히 →</span>
          </a>
        </div>
      </section>

      <!-- 다음 단계 안내 -->
      <section class="mb-10">
        <Callout client:load variant="info" title="상세 가이드 준비 중">
          <p class="text-sm">
            더 자세한 데이터베이스 연결 가이드를 준비하고 있습니다.
            먼저 <a href="/start/60min" class="text-primary hover:underline">60분 완주</a>를 완료하고,
            <a href="/cycle/0-overview" class="text-primary hover:underline">학습 사이클</a>을 따라가며 기초를 다지세요.
          </p>
        </Callout>
      </section>
    </article>

    <nav class="flex items-center justify-between pt-8 border-t border-border">
      <a
        href="/cycle/0-overview"
        class="group flex items-center gap-3 px-4 py-2 rounded-lg border border-border hover:bg-surface transition-colors no-underline"
      >
        <svg class="w-5 h-5 text-text-secondary group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        <div class="text-left">
          <span class="text-xs text-text-secondary">이전</span>
          <span class="block text-sm text-white font-medium">학습 사이클 개요</span>
        </div>
      </a>

      <a
        href="/cycle/auth"
        class="group flex items-center gap-3 px-4 py-2 rounded-lg bg-primary hover:bg-primary-hover text-background transition-colors no-underline"
      >
        <div class="text-right">
          <span class="text-xs opacity-70">다음</span>
          <span class="block text-sm font-bold">사용자 인증</span>
        </div>
        <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </nav>
  </div>
</DocsLayout>
