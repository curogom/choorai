---
import DocsLayout from '../../layouts/DocsLayout.astro';
import ErrorCard from '../../components/ErrorCard';
import CodeBlock from '../../components/CodeBlock';
import Callout from '../../components/Callout';
import TroubleshootingTemplate from '../../components/TroubleshootingTemplate.astro';

const faqStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: [
    {
      '@type': 'Question',
      name: 'CORS 에러는 왜 발생하나요?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: '프론트엔드와 백엔드 출처가 다를 때 서버의 허용 목록에 프론트엔드 도메인이 없으면 CORS 에러가 발생합니다.',
      },
    },
    {
      '@type': 'Question',
      name: '가장 빠른 해결 방법은 무엇인가요?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: '백엔드 CORS 설정에 프론트엔드 도메인을 명시하고, preflight OPTIONS 요청과 credentials 사용 여부를 함께 확인합니다.',
      },
    },
  ],
};
---

<DocsLayout
  title="CORS 에러 해결하기"
  description="Access to XMLHttpRequest blocked by CORS policy 에러 해결 방법"
  currentPath="/fix/cors"
  structuredData={[faqStructuredData]}
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <!-- 브레드크럼 -->
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="현재 위치">
      <a href="/" class="hover:text-white transition-colors">홈</a>
      <span>/</span>
      <a href="/fix" class="hover:text-white transition-colors">트러블슈팅</a>
      <span>/</span>
      <span class="text-primary font-medium">CORS 에러</span>
    </nav>

    <!-- 페이지 제목 -->
    <header class="mb-8 pb-6 border-b border-border">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-error/10 text-error text-xs font-bold mb-4">
        자주 발생하는 에러
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        CORS 에러 해결하기
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        "Access to XMLHttpRequest blocked by CORS policy" 에러가 발생했나요?
        프론트엔드와 백엔드가 다른 도메인에 있을 때 흔히 발생하는 문제입니다.
      </p>
    </header>

    <!-- TL;DR -->
    <section class="mb-8">
      <Callout client:load variant="tip" title="TL;DR (핵심 요약)">
        <p class="mt-2">
          백엔드 서버에서 <code class="bg-surface px-1 rounded">Access-Control-Allow-Origin</code> 헤더를 설정하세요.
          개발 중에는 <code class="bg-surface px-1 rounded">*</code>로, 프로덕션에서는 실제 도메인을 지정하세요.
        </p>
      </Callout>
    </section>

    <!-- 에러 카드 -->
    <section class="mb-8 space-y-6">
      <ErrorCard
        client:load
        errorMessage="Access to XMLHttpRequest at 'http://api.example.com' from origin 'http://localhost:3000' has been blocked by CORS policy"
        errorCode="403"
        severity="critical"
        cause="프론트엔드(localhost:3000)가 다른 도메인의 백엔드(api.example.com)에 요청을 보냈지만, 백엔드가 이 요청을 허용하지 않았습니다."
        solutionCode="Access-Control-Allow-Origin: https://your-frontend.com"
        aiPrompt="CORS 에러가 발생했어. 프론트엔드는 localhost:3000이고 백엔드는 FastAPI야. 어떻게 해결해?"
      />
    </section>

    <!-- 해결 방법 -->
    <article class="prose prose-invert max-w-none">
      <h2 class="text-2xl font-bold text-white mb-4">프레임워크별 해결 방법</h2>

      <!-- FastAPI -->
      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
          <span class="px-2 py-0.5 rounded bg-green-500/20 text-green-400 text-xs font-bold">Python</span>
          FastAPI
        </h3>
        <CodeBlock
          client:load
          filename="main.py"
          code={`from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

# CORS 설정
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000",      # 개발 환경
        "https://your-domain.com",    # 프로덕션
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)`}
        />
      </section>

      <!-- Express -->
      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
          <span class="px-2 py-0.5 rounded bg-yellow-500/20 text-yellow-400 text-xs font-bold">Node.js</span>
          Express
        </h3>
        <CodeBlock
          client:load
          filename="server.js"
          code={`const express = require('express');
const cors = require('cors');

const app = express();

// CORS 설정
app.use(cors({
  origin: [
    'http://localhost:3000',
    'https://your-domain.com'
  ],
  credentials: true
}));`}
        />
      </section>

      <!-- 주의사항 -->
      <section class="mb-8">
        <Callout client:load variant="warning" title="보안 주의">
          <p class="mt-2">
            프로덕션에서는 <code class="bg-surface px-1 rounded">allow_origins=["*"]</code>를 사용하지 마세요!
            실제 프론트엔드 도메인만 허용해야 합니다.
          </p>
        </Callout>
      </section>

      <!-- 검증 방법 -->
      <section class="mb-8">
        <h2 class="text-2xl font-bold text-white mb-4">해결 확인 방법</h2>
        <ol class="list-decimal list-inside text-text-secondary space-y-2">
          <li>백엔드 서버를 재시작합니다</li>
          <li>브라우저 개발자 도구(F12) → Network 탭을 엽니다</li>
          <li>요청을 다시 보내고 Response Headers를 확인합니다</li>
          <li><code class="bg-surface px-1 rounded">Access-Control-Allow-Origin</code> 헤더가 있으면 성공!</li>
        </ol>
      </section>
    </article>

    <TroubleshootingTemplate topic="cors" />

    <!-- 관련 문서 -->
    <section class="mt-12 pt-8 border-t border-border">
      <h3 class="text-lg font-bold text-white mb-4">관련 문서</h3>
      <div class="grid md:grid-cols-2 gap-4">
        <a href="/fix/env" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">환경 변수 에러</h4>
          <p class="text-text-secondary text-sm">process.env.XXX is undefined</p>
        </a>
        <a href="/fix/auth-cookie" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">인증/쿠키 문제</h4>
          <p class="text-text-secondary text-sm">쿠키가 전송되지 않는 문제</p>
        </a>
      </div>
    </section>
  </div>
</DocsLayout>
