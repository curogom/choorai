---
import DocsLayout from '../../layouts/DocsLayout.astro';
import ErrorCard from '../../components/ErrorCard';
import CodeBlock from '../../components/CodeBlock';
import Callout from '../../components/Callout';
import TroubleshootingTemplate from '../../components/TroubleshootingTemplate.astro';

const faqStructuredData = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: [
    {
      '@type': 'Question',
      name: '빌드가 실패하면 가장 먼저 무엇을 확인해야 하나요?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: '에러 로그의 파일 경로와 라인 번호를 먼저 확인하고, 타입 오류인지 의존성 문제인지 원인 범주를 구분해야 합니다.',
      },
    },
    {
      '@type': 'Question',
      name: 'Module not found 에러는 어떻게 해결하나요?',
      acceptedAnswer: {
        '@type': 'Answer',
        text: '누락된 패키지를 설치하고 import 경로를 점검한 뒤 lockfile 상태에서 npm install 또는 npm ci를 다시 실행합니다.',
      },
    },
  ],
};
---

<DocsLayout
  title="빌드 실패 해결하기"
  description="npm run build 에러 해결 방법"
  currentPath="/fix/build-fail"
  structuredData={[faqStructuredData]}
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="현재 위치">
      <a href="/" class="hover:text-white transition-colors">홈</a>
      <span>/</span>
      <a href="/fix" class="hover:text-white transition-colors">트러블슈팅</a>
      <span>/</span>
      <span class="text-primary font-medium">빌드 실패</span>
    </nav>

    <header class="mb-8 pb-6 border-b border-border">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-error/10 text-error text-xs font-bold mb-4">
        배포 전 필수 해결
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        빌드 실패 해결하기
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        "npm run build exited with code 1" 에러가 발생했나요?
        코드에 문제가 있거나 의존성이 누락되었을 수 있습니다.
      </p>
    </header>

    <section class="mb-8">
      <Callout client:load variant="tip" title="TL;DR (핵심 요약)">
        <p class="mt-2">
          1) 에러 메시지를 잘 읽으세요 (어떤 파일, 몇 번째 줄)
          2) TypeScript 에러면 타입 문제
          3) Module not found면 패키지 설치 필요
          4) <code class="bg-surface px-1 rounded">npm install</code> 후 다시 빌드
        </p>
      </Callout>
    </section>

    <section class="mb-8 space-y-6">
      <ErrorCard
        client:load
        errorMessage='Error: Command "npm run build" exited with 1'
        errorCode="BUILD_FAIL"
        severity="critical"
        cause="빌드 스크립트 실행 중 오류가 발생했습니다. TypeScript 타입 에러, 누락된 모듈, 구문 오류 등이 원인일 수 있습니다."
        solution={[
          "터미널에서 에러 메시지 전체를 확인하세요",
          "에러가 발생한 파일과 줄 번호를 찾으세요",
          "로컬에서 npm run build를 실행해 같은 에러가 나는지 확인",
          "에러 메시지를 AI에게 복사해서 물어보세요"
        ]}
        aiPrompt="npm run build 했더니 에러가 나. 에러 메시지: [여기에 에러 복사]. 어떻게 해결해?"
      />

      <ErrorCard
        client:load
        errorMessage="Module not found: Can't resolve 'package-name'"
        severity="warning"
        cause="코드에서 import한 패키지가 설치되지 않았습니다."
        solutionCode="npm install package-name"
        aiPrompt="Module not found: Can't resolve 'axios' 에러가 나. 어떻게 해결해?"
      />

      <ErrorCard
        client:load
        errorMessage="Type error: Property 'xxx' does not exist on type 'yyy'"
        severity="warning"
        cause="TypeScript가 타입 불일치를 감지했습니다. 변수나 함수의 타입이 맞지 않습니다."
        solution={[
          "해당 변수의 타입을 확인하세요",
          "타입 정의가 누락되었다면 추가하세요",
          "any 타입으로 임시 해결 가능 (비추천)"
        ]}
        aiPrompt="TypeScript에서 Property 'name' does not exist on type 'never' 에러가 나. 코드는 [코드 복사]. 어떻게 고쳐?"
      />
    </section>

    <article class="prose prose-invert max-w-none">
      <h2 class="text-2xl font-bold text-white mb-4">자주 발생하는 빌드 에러</h2>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3">1. 의존성 문제</h3>
        <CodeBlock
          client:load
          filename="터미널"
          code={`# node_modules 삭제 후 재설치
rm -rf node_modules package-lock.json
npm install

# 또는 캐시 정리
npm cache clean --force
npm install`}
        />
      </section>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3">2. 환경 변수 누락</h3>
        <p class="text-text-secondary mb-3">
          빌드 시 필요한 환경 변수가 없으면 실패합니다.
          CI/CD 환경에서 환경 변수를 설정했는지 확인하세요.
        </p>
        <Callout client:load variant="info">
          Cloudflare Pages, Vercel 등에서 Settings → Environment Variables에서 설정
        </Callout>
      </section>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3">3. TypeScript 엄격 모드</h3>
        <p class="text-text-secondary mb-3">
          TypeScript의 엄격한 타입 체크를 임시로 완화하려면:
        </p>
        <CodeBlock
          client:load
          filename="tsconfig.json"
          code={`{
  "compilerOptions": {
    "strict": false,           // 임시 해결 (비추천)
    "noImplicitAny": false,    // any 허용
    "skipLibCheck": true       // 라이브러리 타입 체크 건너뛰기
  }
}`}
        />
        <Callout client:load variant="warning" title="주의">
          <p class="mt-2">
            이 방법은 임시 해결책입니다. 타입 에러는 근본적으로 해결하는 것이 좋습니다.
          </p>
        </Callout>
      </section>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3">4. 로컬에서 빌드 테스트</h3>
        <p class="text-text-secondary mb-3">
          배포 전에 항상 로컬에서 빌드가 성공하는지 확인하세요:
        </p>
        <CodeBlock
          client:load
          filename="터미널"
          code={`# 빌드 실행
npm run build

# 빌드 결과물로 미리보기
npm run preview`}
        />
      </section>
    </article>

    <TroubleshootingTemplate topic="build-fail" />

    <section class="mt-12 pt-8 border-t border-border">
      <h3 class="text-lg font-bold text-white mb-4">관련 문서</h3>
      <div class="grid md:grid-cols-2 gap-4">
        <a href="/fix/env" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">환경 변수 에러</h4>
          <p class="text-text-secondary text-sm">process.env.XXX is undefined</p>
        </a>
        <a href="/fix/spa-404" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">SPA 404 에러</h4>
          <p class="text-text-secondary text-sm">배포 후 새로고침 시 404</p>
        </a>
      </div>
    </section>
  </div>
</DocsLayout>
