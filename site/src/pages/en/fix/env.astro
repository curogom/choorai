---
import DocsLayout from '../../../layouts/DocsLayout.astro';
import ErrorCard from '../../../components/ErrorCard';
import CodeBlock from '../../../components/CodeBlock';
import Callout from '../../../components/Callout';
---

<DocsLayout
  lang="en"
  title="Fixing Environment Variable Errors"
  description="How to fix process.env.XXX is undefined error"
  currentPath="/fix/env"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="Breadcrumb">
      <a href="/en" class="hover:text-white transition-colors">Home</a>
      <span>/</span>
      <a href="/en/fix" class="hover:text-white transition-colors">Troubleshooting</a>
      <span>/</span>
      <span class="text-primary font-medium">Environment Variables</span>
    </nav>

    <header class="mb-8 pb-6 border-b border-border">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-warning/10 text-warning text-xs font-bold mb-4">
        Common Error
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        Fixing Environment Variable Errors
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        Getting "process.env.API_KEY is undefined"?
        This happens when environment variables are not properly configured.
      </p>
    </header>

    <section class="mb-8">
      <Callout client:load locale="en" variant="tip" title="TL;DR">
        <p class="mt-2">
          1) Create a <code class="bg-surface px-1 rounded">.env</code> file
          2) Add <code class="bg-surface px-1 rounded">VITE_</code> or <code class="bg-surface px-1 rounded">NEXT_PUBLIC_</code> prefix to variable names
          3) Restart the server
        </p>
      </Callout>
    </section>

    <section class="mb-8 space-y-6">
      <ErrorCard
        client:load
        errorMessage="process.env.API_KEY is undefined"
        severity="warning"
        cause="The environment variable is not set, or you're using a variable that is not accessible from the frontend."
        solution={[
          "Create a .env file in the project root",
          "Vite: Add the VITE_ prefix to variable names",
          "Next.js: Add the NEXT_PUBLIC_ prefix to variable names",
          "Restart the server"
        ]}
        aiPrompt="My environment variables are showing as undefined in a Vite project. I created the .env file but don't know why it's not working."
      />
    </section>

    <article class="prose prose-invert max-w-none">
      <h2 class="text-2xl font-bold text-white mb-4">Setup by Framework</h2>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
          <span class="px-2 py-0.5 rounded bg-purple-500/20 text-purple-400 text-xs font-bold">Vite</span>
          React + Vite
        </h3>
        <CodeBlock
          client:load
          filename=".env"
          code={`# Accessible from frontend (VITE_ prefix required!)
VITE_API_URL=https://api.example.com
VITE_PUBLIC_KEY=pk_test_xxx

# Not accessible from frontend (server-only)
DATABASE_URL=postgres://...
SECRET_KEY=your-secret`}
        />
        <p class="text-text-secondary text-sm mt-3">
          Usage: <code class="bg-surface px-1 rounded">import.meta.env.VITE_API_URL</code>
        </p>
      </section>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
          <span class="px-2 py-0.5 rounded bg-black text-white text-xs font-bold">Next.js</span>
        </h3>
        <CodeBlock
          client:load
          filename=".env.local"
          code={`# Accessible from frontend (NEXT_PUBLIC_ prefix required!)
NEXT_PUBLIC_API_URL=https://api.example.com

# Server-only
DATABASE_URL=postgres://...`}
        />
        <p class="text-text-secondary text-sm mt-3">
          Usage: <code class="bg-surface px-1 rounded">process.env.NEXT_PUBLIC_API_URL</code>
        </p>
      </section>

      <section class="mb-8">
        <h3 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
          <span class="px-2 py-0.5 rounded bg-green-500/20 text-green-400 text-xs font-bold">Python</span>
          FastAPI
        </h3>
        <CodeBlock
          client:load
          filename=".env"
          code={`DATABASE_URL=postgres://user:pass@localhost/db
SECRET_KEY=your-secret-key
DEBUG=true`}
        />
        <CodeBlock
          client:load
          filename="config.py"
          code={`from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    database_url: str
    secret_key: str
    debug: bool = False

    class Config:
        env_file = ".env"

settings = Settings()`}
        />
      </section>

      <section class="mb-8">
        <Callout client:load locale="en" variant="warning" title="Add to .gitignore!">
          <p class="mt-2">
            <code class="bg-surface px-1 rounded">.env</code> files contain sensitive information.
            Make sure to add them to <code class="bg-surface px-1 rounded">.gitignore</code> so they don't get uploaded to GitHub.
          </p>
        </Callout>
        <CodeBlock
          client:load
          filename=".gitignore"
          code={`# Environment variable files
.env
.env.local
.env.*.local`}
        />
      </section>
    </article>

    <section class="mt-12 pt-8 border-t border-border">
      <h3 class="text-lg font-bold text-white mb-4">Related Articles</h3>
      <div class="grid md:grid-cols-2 gap-4">
        <a href="/en/fix/build-fail" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">Build Failure</h4>
          <p class="text-text-secondary text-sm">npm run build error</p>
        </a>
        <a href="/en/fix/cors" class="p-4 bg-surface border border-border rounded-lg hover:border-primary/50 transition-colors no-underline">
          <h4 class="text-white font-medium mb-1">CORS Error</h4>
          <p class="text-text-secondary text-sm">CORS issue when calling API</p>
        </a>
      </div>
    </section>
  </div>
</DocsLayout>
