---
import DocsLayout from '../../../layouts/DocsLayout.astro';
import Callout from '../../../components/Callout';
import CodeBlock from '../../../components/CodeBlock';
import Checklist from '../../../components/Checklist';
import SectionHeader from '../../../components/SectionHeader';
import MetaBadge from '../../../components/MetaBadge';
import PageNavigation from '../../../components/PageNavigation.astro';

const deployChecklist = [
  { id: 'github', label: 'Push code to GitHub', description: 'git push origin main' },
  { id: 'cloudflare', label: 'Create Cloudflare account', description: 'dash.cloudflare.com' },
  { id: 'connect', label: 'Connect GitHub', description: 'Link in Cloudflare Pages' },
  { id: 'deploy', label: 'Deploy complete', description: 'Verify automatic deployment' },
  { id: 'domain', label: 'Custom domain (optional)', description: 'Connect your own domain' },
];
---

<DocsLayout
  lang="en"
  title="Cloudflare Pages Deployment Guide"
  description="How to deploy React/Vite apps to Cloudflare Pages for free"
  currentPath="/deploy/cloudflare-pages"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="Breadcrumb">
      <a href="/en" class="hover:text-white transition-colors">Home</a>
      <span>/</span>
      <a href="/en/deploy" class="hover:text-white transition-colors">Deploy</a>
      <span>/</span>
      <span class="text-primary font-medium">Cloudflare Pages</span>
    </nav>

    <header class="mb-8 pb-6 border-b border-border">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-orange-500/10 text-orange-400 text-xs font-bold mb-4">
        Free Hosting
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        Deploy with Cloudflare Pages
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        Deploy frontend apps like React, Vue, and Astro for free.
        Automatic deployment every time you push via GitHub integration.
      </p>
    </header>

    <section class="mb-8">
      <Callout client:load locale="en" variant="tip" title="Why Cloudflare Pages?">
        <ul class="list-disc list-inside space-y-1 mt-2">
          <li>Free (unlimited requests, unlimited bandwidth)</li>
          <li>Fast speeds with global CDN</li>
          <li>Automatic HTTPS</li>
          <li>Auto-deploy via GitHub integration</li>
        </ul>
      </Callout>
    </section>

    <article class="prose prose-invert max-w-none">
      <!-- Step 1 -->
      <section class="mb-10">
        <SectionHeader number={1} title="Push Code to GitHub" />

        <p class="text-text-secondary mb-4">
          Your code must be in a GitHub repository to deploy.
        </p>

        <CodeBlock
          client:load
          code={`# Initialize repository (if first time)
git init

# Add files
git add .

# Commit
git commit -m "Initial commit"

# Connect GitHub repository (if first time)
git remote add origin https://github.com/username/my-project.git

# Push
git push -u origin main`}
          filename="Terminal"
        />

        <Callout client:load locale="en" variant="info">
          <p>
            If you don't have a GitHub repository, create one at <a href="https://github.com/new" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">github.com/new</a>.
          </p>
        </Callout>
      </section>

      <!-- Step 2 -->
      <section class="mb-10">
        <SectionHeader number={2} title="Configure Cloudflare Pages" />

        <ol class="list-decimal list-inside text-text-secondary space-y-4">
          <li>
            <a href="https://dash.cloudflare.com/sign-up" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">
              Sign up for Cloudflare
            </a> (free)
          </li>
          <li>Click <strong class="text-white">Workers & Pages</strong> in the dashboard</li>
          <li>Select <strong class="text-white">Create application</strong> → <strong class="text-white">Pages</strong></li>
          <li>Click <strong class="text-white">Connect to Git</strong></li>
          <li>Connect your GitHub account and select repository</li>
        </ol>

        <div class="mt-6 p-4 bg-surface border border-border rounded-xl">
          <h3 class="text-white font-bold mb-3">Build Settings (by framework)</h3>

          <div class="space-y-4">
            <div>
              <h4 class="text-sm font-bold text-primary mb-2">React + Vite</h4>
              <ul class="text-text-secondary text-sm space-y-1">
                <li>Build command: <code class="bg-background px-1 rounded">npm run build</code></li>
                <li>Build output: <code class="bg-background px-1 rounded">dist</code></li>
              </ul>
            </div>

            <div>
              <h4 class="text-sm font-bold text-primary mb-2">Next.js</h4>
              <ul class="text-text-secondary text-sm space-y-1">
                <li>Build command: <code class="bg-background px-1 rounded">npx @cloudflare/next-on-pages@1</code></li>
                <li>Build output: <code class="bg-background px-1 rounded">.vercel/output/static</code></li>
              </ul>
            </div>

            <div>
              <h4 class="text-sm font-bold text-primary mb-2">Astro</h4>
              <ul class="text-text-secondary text-sm space-y-1">
                <li>Build command: <code class="bg-background px-1 rounded">npm run build</code></li>
                <li>Build output: <code class="bg-background px-1 rounded">dist</code></li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Step 3 -->
      <section class="mb-10">
        <SectionHeader number={3} title="SPA Routing Configuration" />

        <p class="text-text-secondary mb-4">
          SPAs using React Router or similar require additional configuration.
          This prevents 404 errors on page refresh.
        </p>

        <CodeBlock
          client:load
          code="/* /index.html 200"
          filename="public/_redirects"
        />

        <p class="text-text-secondary text-sm mt-2">
          Create this file in the <code class="bg-surface px-1 rounded">public</code> folder.
        </p>

        <Callout client:load locale="en" variant="warning" title="What happens without this?">
          <p class="mt-2">
            Refreshing on a page like <code class="bg-surface px-1 rounded">/about</code> will result in a 404.
            See <a href="/en/fix/spa-404" class="text-primary hover:underline">Fixing SPA 404 Errors</a> for details.
          </p>
        </Callout>
      </section>

      <!-- Step 4 -->
      <section class="mb-10">
        <SectionHeader number={4} title="Environment Variables (if needed)" />

        <p class="text-text-secondary mb-4">
          Set sensitive information like API keys as environment variables.
        </p>

        <ol class="list-decimal list-inside text-text-secondary space-y-2 mb-4">
          <li>Cloudflare dashboard → Select project</li>
          <li><strong class="text-white">Settings</strong> → <strong class="text-white">Environment variables</strong></li>
          <li>Add variable (e.g., <code class="bg-surface px-1 rounded">VITE_API_URL</code>)</li>
          <li>Can distinguish between Production/Preview environments</li>
        </ol>

        <Callout client:load locale="en" variant="info">
          <p>
            When using Vite, environment variable names must start with <code class="bg-surface px-1 rounded">VITE_</code>.
            See <a href="/en/troubleshooting/env" class="text-primary hover:underline">Fixing Environment Variable Errors</a> for details.
          </p>
        </Callout>
      </section>

      <!-- Step 5 -->
      <section class="mb-10">
        <SectionHeader number={5} title="Custom Domain (optional)" />

        <p class="text-text-secondary mb-4">
          A default <code class="bg-surface px-1 rounded">project-name.pages.dev</code> domain is provided.
          Additional configuration is needed to use your own domain.
        </p>

        <ol class="list-decimal list-inside text-text-secondary space-y-2 mb-4">
          <li>Project → <strong class="text-white">Custom domains</strong></li>
          <li>Click <strong class="text-white">Set up a custom domain</strong></li>
          <li>Enter domain (e.g., <code class="bg-surface px-1 rounded">myapp.com</code>)</li>
          <li>Follow DNS setup instructions</li>
        </ol>

        <Callout client:load locale="en" variant="tip">
          <p>
            If you manage your domain with Cloudflare DNS, it connects automatically.
            For other DNS providers, you'll need to add a CNAME record.
          </p>
        </Callout>
      </section>

      <!-- Checklist -->
      <section class="mb-10">
        <Checklist
          client:load
          locale="en"
          storageKey="deploy-cloudflare"
          title="Deployment Checklist"
          items={deployChecklist}
        />
      </section>

      <!-- Post-deploy -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">Deployment Complete!</h2>

        <div class="p-6 bg-success/10 border border-success/30 rounded-xl">
          <div class="flex items-center gap-3 mb-4">
            <svg class="w-8 h-8 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="text-white font-bold text-xl">Congratulations!</h3>
          </div>
          <p class="text-text-secondary">
            Your app will now automatically deploy every time you push code to GitHub.
            Check it at <code class="bg-background px-1 rounded">project-name.pages.dev</code>.
          </p>
        </div>
      </section>
    </article>

    <PageNavigation currentPath="/deploy/cloudflare-pages" lang="en" />
  </div>
</DocsLayout>
