---
import DocsLayout from '../../../layouts/DocsLayout.astro';
import Callout from '../../../components/Callout';
import CodeBlock from '../../../components/CodeBlock';
import PageNavigation from '../../../components/PageNavigation.astro';
---

<DocsLayout
  lang="en"
  title="Cycle 2: Frontend Deployment"
  description="How to deploy a React app to Cloudflare Pages"
  currentPath="/map/frontend"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="Breadcrumb">
      <a href="/" class="hover:text-white transition-colors">Home</a>
      <span>/</span>
      <a href="/map" class="hover:text-white transition-colors">Learning Cycles</a>
      <span>/</span>
      <span class="text-primary font-medium">Cycle 2: Frontend</span>
    </nav>

    <header class="mb-8 pb-6 border-b border-border">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-bold mb-4">
        Cycle 2
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        Frontend Deployment
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        Build a React app and deploy it to Cloudflare Pages.
        Serve your application quickly to users around the world.
      </p>
    </header>

    <section class="mb-10">
      <Callout client:load locale="en" variant="tip" title="What you'll learn in this Cycle">
        <ul class="list-disc list-inside space-y-1 mt-2">
          <li>The concept of frontend deployment</li>
          <li>Understanding the build process</li>
          <li>Deploying to Cloudflare Pages</li>
          <li>Solving SPA routing issues</li>
        </ul>
      </Callout>
    </section>

    <article class="prose prose-invert max-w-none">
      <!-- What is Frontend Deployment? -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">What is Frontend Deployment?</h2>

        <p class="text-text-secondary mb-4">
          A frontend app is ultimately just <strong class="text-white">HTML, CSS, and JavaScript files</strong>.
          Deployment means uploading these static files to a server so anyone can access them.
        </p>

        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <div class="p-4 bg-surface border border-border rounded-xl">
            <h3 class="text-white font-bold mb-2">Static Sites</h3>
            <p class="text-text-secondary text-sm">Works with just HTML/CSS/JS files, no server needed</p>
            <p class="text-text-secondary text-sm mt-2">Examples: blogs, portfolios, documentation sites</p>
          </div>
          <div class="p-4 bg-surface border border-border rounded-xl">
            <h3 class="text-white font-bold mb-2">SPA (Single Page App)</h3>
            <p class="text-text-secondary text-sm">JavaScript handles page transitions and API communication</p>
            <p class="text-text-secondary text-sm mt-2">Examples: React, Vue, Angular apps</p>
          </div>
        </div>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">CDN and Edge Deployment</h3>
        <p class="text-text-secondary mb-4">
          Cloudflare Pages replicates your files across 300+ data centers worldwide.
          Files are served from the server closest to the user, making it fast.
        </p>

        <div class="bg-surface border border-border rounded-xl p-4">
          <div class="flex items-center gap-4 text-sm">
            <div class="text-center">
              <div class="w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center mb-2">
                <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
              </div>
              <span class="text-text-secondary">User</span>
            </div>
            <div class="text-text-secondary">→</div>
            <div class="text-center">
              <div class="w-12 h-12 rounded-full bg-orange-500/20 flex items-center justify-center mb-2">
                <svg class="w-6 h-6 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
                </svg>
              </div>
              <span class="text-text-secondary">CDN Edge</span>
            </div>
            <div class="text-text-secondary">→</div>
            <div class="text-center">
              <div class="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center mb-2">
                <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
              </div>
              <span class="text-text-secondary">Fast Response</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Build Process -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">Build Process</h2>

        <p class="text-text-secondary mb-4">
          Browsers cannot directly execute React source code.
          The <strong class="text-white">build</strong> process transforms it into a format browsers can understand.
        </p>

        <CodeBlock
          client:load
          code={`# Build a React project
npm run build

# Result: dist/ or build/ folder is created`}
          filename="Terminal"
        />

        <h3 class="text-lg font-bold text-white mt-6 mb-3">Build Output (dist/)</h3>

        <CodeBlock
          client:load
          code={`dist/
├── index.html          # Entry point HTML
├── assets/
│   ├── index-abc123.js  # Bundled JavaScript
│   ├── index-def456.css # Bundled CSS
│   └── logo.svg         # Static assets
└── favicon.ico`}
          filename="Folder Structure"
        />

        <p class="text-text-secondary mt-4 text-sm">
          Hashes like <code class="bg-surface px-1 rounded">abc123</code> are for cache invalidation.
          When files change, the hash changes so users receive the new version.
        </p>
      </section>

      <!-- Cloudflare Pages Deployment -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">Cloudflare Pages Deployment</h2>

        <div class="space-y-6">
          <div class="p-4 bg-surface border border-border rounded-xl">
            <h3 class="text-white font-bold mb-3 flex items-center gap-2">
              <span class="flex items-center justify-center w-6 h-6 rounded-full bg-primary text-background text-sm font-bold">1</span>
              Connect GitHub Repository
            </h3>
            <ol class="text-text-secondary text-sm space-y-2 ml-8">
              <li>1. Go to the <a href="https://dash.cloudflare.com" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">Cloudflare Dashboard</a></li>
              <li>2. Workers & Pages → Create application</li>
              <li>3. Pages tab → Connect to Git</li>
              <li>4. Connect your GitHub account and select a repository</li>
            </ol>
          </div>

          <div class="p-4 bg-surface border border-border rounded-xl">
            <h3 class="text-white font-bold mb-3 flex items-center gap-2">
              <span class="flex items-center justify-center w-6 h-6 rounded-full bg-primary text-background text-sm font-bold">2</span>
              Build Settings
            </h3>
            <div class="overflow-x-auto">
              <table class="w-full text-sm">
                <tbody>
                  <tr class="border-b border-border/50">
                    <td class="py-2 px-3 text-white font-medium">Framework preset</td>
                    <td class="py-2 px-3 text-text-secondary">Create React App / Vite</td>
                  </tr>
                  <tr class="border-b border-border/50">
                    <td class="py-2 px-3 text-white font-medium">Build command</td>
                    <td class="py-2 px-3"><code class="bg-background px-1 rounded">npm run build</code></td>
                  </tr>
                  <tr class="border-b border-border/50">
                    <td class="py-2 px-3 text-white font-medium">Build output directory</td>
                    <td class="py-2 px-3"><code class="bg-background px-1 rounded">dist</code> (Vite) / <code class="bg-background px-1 rounded">build</code> (CRA)</td>
                  </tr>
                  <tr>
                    <td class="py-2 px-3 text-white font-medium">Root directory</td>
                    <td class="py-2 px-3 text-text-secondary">(Leave empty or enter frontend folder name)</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="p-4 bg-surface border border-border rounded-xl">
            <h3 class="text-white font-bold mb-3 flex items-center gap-2">
              <span class="flex items-center justify-center w-6 h-6 rounded-full bg-primary text-background text-sm font-bold">3</span>
              Environment Variables
            </h3>
            <p class="text-text-secondary text-sm mb-3">
              Configure them in Settings → Environment variables.
            </p>
            <CodeBlock
              client:load
              code={`# Example environment variables
VITE_API_URL=https://api.myapp.com
VITE_APP_NAME=MyApp`}
              filename="Environment Variables"
            />
            <p class="text-text-secondary text-sm mt-2">
              <strong class="text-white">Vite:</strong> <code class="bg-background px-1 rounded">VITE_</code> prefix required<br/>
              <strong class="text-white">CRA:</strong> <code class="bg-background px-1 rounded">REACT_APP_</code> prefix required
            </p>
          </div>
        </div>
      </section>

      <!-- SPA Routing Issue -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">Solving SPA Routing Issues</h2>

        <Callout client:load locale="en" variant="warning" title="Getting 404 errors?">
          <p class="mt-2 text-sm">
            In an SPA, navigating directly to a path like <code class="bg-surface px-1 rounded">/about</code> will result in a 404.
            This is because the server only has <code class="bg-surface px-1 rounded">index.html</code>.
          </p>
        </Callout>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">Solution: _redirects File</h3>

        <p class="text-text-secondary mb-4">
          Create a <code class="bg-surface px-1 rounded">public/_redirects</code> file.
          This sends all requests to <code class="bg-surface px-1 rounded">index.html</code>,
          and React Router handles the routing on the client side.
        </p>

        <CodeBlock
          client:load
          code={`/* /index.html 200`}
          filename="public/_redirects"
        />

        <p class="text-text-secondary mt-4 text-sm">
          This single line redirects all paths to <code class="bg-surface px-1 rounded">index.html</code>.
          It responds with a 200 status code, so refreshing the page still works correctly.
        </p>
      </section>

      <!-- Next Steps -->
      <section class="mb-10">
        <Callout client:load locale="en" variant="info" title="Next Steps">
          <p class="text-sm">
            If frontend deployment is complete, let's deploy a backend API next.
            In <a href="/map/backend" class="text-primary hover:underline ml-1">Cycle 3: Backend Deployment</a>,
            you will learn how to deploy FastAPI to Cloud Run.
          </p>
        </Callout>
      </section>
    </article>

    <PageNavigation currentPath="/map/frontend" />
  </div>
</DocsLayout>
