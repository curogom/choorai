---
import DocsLayout from '../../../../../layouts/DocsLayout.astro';
import Stepper from '../../../../../components/Stepper';
import ChallengeProgressBar from '../../../../../components/ChallengeProgressBar';
import Checklist from '../../../../../components/Checklist';
import CodeBlock from '../../../../../components/CodeBlock';
import PromptBox from '../../../../../components/PromptBox';
import Callout from '../../../../../components/Callout';
import SectionHeader from '../../../../../components/SectionHeader';
import MetaBadge from '../../../../../components/MetaBadge';
import PageNavigation from '../../../../../components/PageNavigation.astro';

const steps = [
  { label: 'Preparation', status: 'completed' as const },
  { label: 'Frontend', status: 'completed' as const },
  { label: 'Backend', status: 'current' as const },
  { label: 'Connect', status: 'upcoming' as const },
  { label: 'Deploy', status: 'upcoming' as const },
  { label: 'Complete', status: 'upcoming' as const },
];

const checklist = [
  { id: 'init', label: 'Initialize project', description: 'npm init -y' },
  { id: 'hono', label: 'Install Hono', description: 'npm install hono @hono/node-server' },
  { id: 'server', label: 'Run server', description: 'npx tsx src/index.ts' },
  { id: 'api', label: 'Create API endpoints', description: 'Implement CRUD' },
];
---

<DocsLayout
  lang="en"
  title="60-Minute Challenge - Hono Backend"
  description="Let's build a Node.js backend with Hono"
  currentPath="/start/60min/backend/hono"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <!-- Breadcrumb -->
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="Breadcrumb">
      <a href="/en" class="hover:text-white transition-colors">Home</a>
      <span>/</span>
      <a href="/en/start/60min" class="hover:text-white transition-colors">60-Min Challenge</a>
      <span>/</span>
      <span class="text-text-secondary">Backend</span>
      <span>/</span>
      <span class="text-primary font-medium">Hono</span>
    </nav>

    <!-- Progress -->
    <div class="mb-8 p-4 bg-surface rounded-xl border border-border">
      <ChallengeProgressBar client:load />
    </div>

    <!-- Step Indicator -->
    <div class="mb-12">
      <Stepper client:load steps={steps} locale="en" />
    </div>

    <!-- Page Title -->
    <header class="mb-8 pb-6 border-b border-border">
      <div class="flex items-center gap-3 mb-4">
        <MetaBadge icon="clock" text="Estimated time: 15 min" />
        <span class="px-2 py-1 rounded bg-green-500/20 text-green-400 text-xs font-bold">Hono</span>
        <span class="px-2 py-1 rounded bg-blue-500/20 text-blue-400 text-xs font-bold">Lv.1 Beginner</span>
      </div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        Backend: Hono
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        Build a backend with JavaScript/TypeScript.
        Using the same language as the frontend reduces the learning curve.
      </p>
    </header>

    <!-- TL;DR -->
    <section class="mb-10">
      <Callout client:load variant="tip" title="TL;DR (Summary)" locale="en">
        <ul class="list-disc list-inside space-y-1 mt-2">
          <li>Install with <code>npm install hono</code></li>
          <li>Write the entire API in a single file</li>
          <li>Complete a CRUD API in 15 minutes</li>
        </ul>
      </Callout>
    </section>

    <!-- Terms -->
    <section class="mb-10">
      <Callout client:load variant="info" title="Terms Before Step 3" locale="en">
        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
          <li><strong>Endpoint</strong>: A URL where your API receives requests.</li>
          <li><strong>HTTP Method</strong>: GET/POST/PUT/DELETE that describe request intent.</li>
          <li><strong>Request/Response</strong>: Input sent by client and output returned by server.</li>
          <li><strong>CRUD</strong>: Core API operations: Create, Read, Update, Delete.</li>
        </ul>
      </Callout>
    </section>

    <!-- Why Hono? -->
    <section class="mb-10">
      <Callout client:load variant="info" title="Why Hono?" locale="en">
        <div class="mt-2 text-sm space-y-2">
          <p>Hono is <strong class="text-white">one of the lightest Node.js web frameworks</strong>:</p>
          <ul class="list-disc list-inside space-y-1">
            <li>Same language as the frontend (JavaScript/TypeScript)</li>
            <li>Faster and more modern than Express</li>
            <li>Almost no boilerplate code</li>
            <li>Edge Runtime (Cloudflare Workers) support</li>
          </ul>
        </div>
      </Callout>
    </section>

    <!-- Main Content -->
    <article class="prose prose-invert max-w-none">
      <!-- Section 1: Create Project -->
      <section class="mb-10">
        <SectionHeader number={1} title="Create Project" />

        <p class="text-text-secondary mb-4">
          Create a backend folder next to the frontend folder (<code>my-todo</code>).
        </p>

        <CodeBlock
          client:load
          code={`# Navigate to the parent folder (where my-todo is located)
cd ..

# Create backend folder
mkdir my-todo-api
cd my-todo-api

# Initialize project
npm init -y

# Install Hono
npm install hono @hono/node-server

# Install TypeScript (optional)
npm install -D typescript @types/node tsx`}
          filename="Terminal"
        />

        <Callout client:load variant="tip" title="Term Tip: npm init / package.json" locale="en">
          <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
            <li><strong>npm init</strong>: Command to create a new Node project setup file.</li>
            <li><strong>package.json</strong>: Metadata file containing scripts and dependencies.</li>
            <li><strong>Script</strong>: Named command shortcuts you can run with npm.</li>
            <li>Deep dive: <a href="/en/map/tools" class="text-primary hover:underline">Tools and terminal basics</a></li>
          </ul>
        </Callout>
      </section>

      <!-- Section 2: Write First API -->
      <section class="mb-10">
        <SectionHeader number={2} title="Write Your First API" />

        <p class="text-text-secondary mb-4">
          Create a <code>src/index.ts</code> file and enter the following code.
        </p>

        <CodeBlock
          client:load
          code={`import { Hono } from 'hono';
import { serve } from '@hono/node-server';
import { cors } from 'hono/cors';

const app = new Hono();

// CORS setup (for frontend connection)
app.use('*', cors({
  origin: ['http://localhost:5173'],
  credentials: true,
}));

// Health check
app.get('/health', (c) => {
  return c.json({ status: 'ok' });
});

// Hello API
app.get('/api/hello', (c) => {
  const name = c.req.query('name') || 'World';
  return c.json({ message: \`Hello, \${name}!\` });
});

// Start server
serve({ fetch: app.fetch, port: 8000 });
console.log('ðŸš€ Server running on http://localhost:8000');`}
          filename="src/index.ts"
        />

        <h3 class="text-lg font-bold text-white mt-6 mb-3">Run the Server</h3>

        <CodeBlock
          client:load
          code={`# Run the server
npx tsx src/index.ts

# Test (in a new terminal)
curl http://localhost:8000/health
curl http://localhost:8000/api/hello?name=Choorai`}
          filename="Terminal"
        />

        <Callout client:load variant="tip" title="Term Tip: CORS / Endpoint" locale="en">
          <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
            <li><strong>Endpoint</strong>: A URL path where your API receives requests.</li>
            <li><strong>CORS</strong>: Browser permission rules for cross-origin frontend/backend calls.</li>
            <li>Deep dive: <a href="/en/fix/cors" class="text-primary hover:underline">CORS troubleshooting</a></li>
          </ul>
        </Callout>

        <div class="mt-4 p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
          <div class="flex items-center gap-2 text-green-400 font-bold mb-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
            </svg>
            Success!
          </div>
          <p class="text-green-300/80 text-sm">
            If you see <code>{`{"status": "ok"}`}</code>, the server is running correctly.
          </p>
        </div>
      </section>

      <!-- Section 3: CRUD API -->
      <section class="mb-10">
        <SectionHeader number={3} title="Todo CRUD API" />

        <p class="text-text-secondary mb-4">
          Now let's add a todo management API. Ask AI with the prompt below.
        </p>

        <PromptBox
          client:load
          locale="en"
          prompt={`Create a Todo CRUD API with Hono.

Requirements:
1. In-memory storage (using Map)
2. Todo type: id, title, is_completed, created_at
3. API Endpoints:
   - GET /api/v1/todos - List (page, page_size query)
   - POST /api/v1/todos - Create (title required)
   - GET /api/v1/todos/:id - Get single item
   - PATCH /api/v1/todos/:id - Update (toggle is_completed)
   - DELETE /api/v1/todos/:id - Delete
4. Input validation (reject empty titles)
5. Error response handling

Add to the existing code.`}
          title="AI Prompt"
          description="Send this to your AI assistant."
        />

        <h3 class="text-lg font-bold text-white mt-6 mb-3">Expected Result API</h3>

        <CodeBlock
          client:load
          code={`# Create a todo
curl -X POST http://localhost:8000/api/v1/todos \\
  -H "Content-Type: application/json" \\
  -d '{"title": "Learn Hono"}'

# List todos
curl http://localhost:8000/api/v1/todos

# Mark as complete
curl -X PATCH http://localhost:8000/api/v1/todos/1 \\
  -H "Content-Type: application/json" \\
  -d '{"is_completed": true}'

# Delete
curl -X DELETE http://localhost:8000/api/v1/todos/1`}
          filename="Terminal"
        />
      </section>

      <!-- Section 4: Folder Structure -->
      <section class="mb-10">
        <SectionHeader number={4} title="Final Folder Structure" />

        <CodeBlock
          client:load
          code={`my-todo-api/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts      # Entry point + router
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts  # Todo type definitions
â”‚   â””â”€â”€ storage/
â”‚       â””â”€â”€ index.ts  # In-memory storage
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json     # (optional)`}
          filename="Folder structure"
        />

        <p class="text-text-secondary mt-4 text-sm">
          The completed example code is available on the
          <a href="https://github.com/curogom/choorai/tree/main/examples/b2c-todo/api-hono" class="text-primary hover:underline">
            GitHub repository
          </a>.
        </p>
      </section>

      <!-- FastAPI vs Hono -->
      <section class="mb-10">
        <h2 class="text-2xl font-bold text-white mb-4">FastAPI vs Hono</h2>

        <div class="overflow-x-auto">
          <table class="w-full text-sm">
            <thead>
              <tr class="border-b border-border">
                <th class="text-left py-3 px-2 text-white">Category</th>
                <th class="text-left py-3 px-2 text-white">Hono</th>
                <th class="text-left py-3 px-2 text-white">FastAPI</th>
              </tr>
            </thead>
            <tbody class="text-text-secondary">
              <tr class="border-b border-border/50">
                <td class="py-3 px-2">Language</td>
                <td class="py-3 px-2 text-green-400">JavaScript/TypeScript</td>
                <td class="py-3 px-2">Python</td>
              </tr>
              <tr class="border-b border-border/50">
                <td class="py-3 px-2">Same as frontend</td>
                <td class="py-3 px-2 text-green-400">Yes, same language</td>
                <td class="py-3 px-2">No, different language</td>
              </tr>
              <tr class="border-b border-border/50">
                <td class="py-3 px-2">Auto documentation</td>
                <td class="py-3 px-2">No</td>
                <td class="py-3 px-2 text-green-400">Yes, via /docs</td>
              </tr>
              <tr>
                <td class="py-3 px-2">Best for</td>
                <td class="py-3 px-2">JS-only devs, quick start</td>
                <td class="py-3 px-2">Python preference, ML integration</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Checklist -->
      <section class="mb-10">
        <Checklist
          client:load
          locale="en"
          storageKey="60min-backend-hono"
          title="Hono Backend Completion Checklist"
          items={checklist}
        />
      </section>

      <!-- Navigation -->
      <PageNavigation currentPath="/start/60min/backend/hono" lang="en" />
    </article>
  </div>
</DocsLayout>
