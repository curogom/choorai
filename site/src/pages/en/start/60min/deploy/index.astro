---
import DocsLayout from '../../../../../layouts/DocsLayout.astro';
import Stepper from '../../../../../components/Stepper';
import ChallengeProgressBar from '../../../../../components/ChallengeProgressBar';
import Checklist from '../../../../../components/Checklist';
import CodeBlock from '../../../../../components/CodeBlock';
import Callout from '../../../../../components/Callout';
import SectionHeader from '../../../../../components/SectionHeader';
import MetaBadge from '../../../../../components/MetaBadge';
import PageNavigation from '../../../../../components/PageNavigation.astro';

const steps = [
  { label: 'Preparation', status: 'completed' as const },
  { label: 'Frontend', status: 'completed' as const },
  { label: 'Backend', status: 'completed' as const },
  { label: 'Connect', status: 'completed' as const },
  { label: 'Deploy', status: 'current' as const },
  { label: 'Complete', status: 'upcoming' as const },
];

const checklist = [
  { id: 'github', label: 'Create GitHub repository', description: 'Push code' },
  { id: 'cloudflare', label: 'Connect Cloudflare Pages', description: 'Deploy frontend' },
  { id: 'env', label: 'Set environment variables', description: 'VITE_API_URL' },
  { id: 'deploy', label: 'Verify deployment', description: 'Access live URL' },
];
---

<DocsLayout
  lang="en"
  title="60-Minute Challenge - Deployment"
  description="Let's deploy the service to the internet"
  currentPath="/start/60min/deploy"
>
  <div class="max-w-4xl mx-auto px-6 py-8">
    <!-- Breadcrumb -->
    <nav class="flex items-center gap-2 text-sm text-text-secondary mb-6" aria-label="Breadcrumb">
      <a href="/en" class="hover:text-white transition-colors">Home</a>
      <span>/</span>
      <a href="/en/start/60min" class="hover:text-white transition-colors">60-Min Challenge</a>
      <span>/</span>
      <span class="text-primary font-medium">Deploy</span>
    </nav>

    <!-- Progress -->
    <div class="mb-8 p-4 bg-surface rounded-xl border border-border">
      <ChallengeProgressBar client:load />
    </div>

    <!-- Step Indicator -->
    <div class="mb-12">
      <Stepper client:load steps={steps} locale="en" />
    </div>

    <!-- Page Title -->
    <header class="mb-8 pb-6 border-b border-border">
      <MetaBadge icon="clock" text="Estimated time: 10 min" />
      <h1 class="text-3xl md:text-4xl font-black text-white mb-4">
        Deploy: Cloudflare Pages
      </h1>
      <p class="text-text-secondary text-lg leading-relaxed">
        This is the final step! Let's publish your service to the internet
        and get a URL to share with friends.
      </p>
    </header>

    <!-- TL;DR -->
    <section class="mb-10">
      <Callout client:load variant="tip" title="TL;DR (Summary)" locale="en">
        <ul class="list-disc list-inside space-y-1 mt-2">
          <li>Push code to GitHub</li>
          <li>Connect repository on Cloudflare Pages</li>
          <li>Auto deploy complete! Share the URL</li>
        </ul>
      </Callout>
    </section>

    <!-- Terms -->
    <section class="mb-10">
      <Callout client:load variant="info" title="Terms Before Step 5" locale="en">
        <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
          <li><strong>Build</strong>: Converting source code into deployable static output.</li>
          <li><strong>Static Assets</strong>: Files like HTML/CSS/JS served without server-side processing.</li>
          <li><strong>Environment Variable</strong>: Runtime config injected in the deployment environment.</li>
          <li><strong>Domain/URL</strong>: Public internet address users use to access your app.</li>
        </ul>
      </Callout>
    </section>

    <!-- Main Content -->
    <article class="prose prose-invert max-w-none">
      <!-- Section 1: GitHub Repository -->
      <section class="mb-10">
        <SectionHeader number={1} title="Push Code to GitHub" />

        <p class="text-text-secondary mb-4">
          First, upload the frontend code to GitHub.
        </p>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">1.1 Create GitHub Repository</h3>

        <ol class="list-decimal list-inside text-text-secondary space-y-2 mb-4">
          <li>Go to <a href="https://github.com/new" class="text-primary hover:underline">github.com/new</a></li>
          <li>Enter Repository name: <code>my-admin</code></li>
          <li>Select Public (for free hosting)</li>
          <li>Click "Create repository"</li>
        </ol>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">1.2 Push Code</h3>

        <p class="text-text-secondary mb-4">
          Run in the frontend folder (<code>my-admin</code>):
        </p>

        <CodeBlock
          client:load
          code={`# Initialize Git
git init

# Check .gitignore (node_modules should be excluded)
cat .gitignore

# Add all files
git add .

# First commit
git commit -m "Initial commit"

# Connect to GitHub (replace YOUR_USERNAME with your account)
git remote add origin https://github.com/YOUR_USERNAME/my-admin.git

# Push
git branch -M main
git push -u origin main`}
          filename="Terminal"
        />

        <Callout client:load variant="info" title="New to Git?" locale="en">
          <p class="text-sm">
            Just copy and paste the commands above.
            Only replace <code>YOUR_USERNAME</code> with your GitHub username.
          </p>
        </Callout>

        <Callout client:load variant="tip" title="Term Tip: Repo / Branch / Push" locale="en">
          <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
            <li><strong>Repository</strong>: A place where your code and history are stored.</li>
            <li><strong>Branch</strong>: A separate line of work. Deploy usually tracks <code>main</code>.</li>
            <li><strong>Push</strong>: Upload your local commits to a remote GitHub repository.</li>
            <li>Deep dive: <a href="/en/map/git" class="text-primary hover:underline">Git Basics</a></li>
          </ul>
        </Callout>
      </section>

      <!-- Section 2: Cloudflare Pages -->
      <section class="mb-10">
        <SectionHeader number={2} title="Deploy with Cloudflare Pages" />

        <p class="text-text-secondary mb-4">
          Cloudflare Pages hosts static sites for free.
        </p>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">2.1 Cloudflare Dashboard</h3>

        <ol class="list-decimal list-inside text-text-secondary space-y-2 mb-4">
          <li>Log in to <a href="https://dash.cloudflare.com" class="text-primary hover:underline">dash.cloudflare.com</a></li>
          <li>Click "Workers & Pages" in the left menu</li>
          <li>Click the "Create" button</li>
          <li>Select the "Pages" tab</li>
          <li>Click "Connect to Git"</li>
        </ol>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">2.2 Connect GitHub</h3>

        <ol class="list-decimal list-inside text-text-secondary space-y-2 mb-4">
          <li>"Add account" then connect your GitHub account</li>
          <li>Select the <code>my-admin</code> repository you just created</li>
          <li>Click "Begin setup"</li>
        </ol>

        <Callout client:load variant="tip" title="Term Tip: Domain / DNS" locale="en">
          <ul class="list-disc list-inside space-y-1 mt-2 text-sm">
            <li><strong>Domain</strong>: The human-readable address users open in a browser.</li>
            <li><strong>DNS</strong>: The system that maps domain names to actual server addresses.</li>
            <li>Deep dive: <a href="/en/map/dns" class="text-primary hover:underline">DNS Basics</a></li>
          </ul>
        </Callout>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">2.3 Build Settings</h3>

        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-4">
          <div class="space-y-4">
            <div>
              <span class="text-gray-400 text-sm">Project name</span>
              <div class="bg-gray-900 rounded px-3 py-2 mt-1 text-white">my-admin</div>
            </div>
            <div>
              <span class="text-gray-400 text-sm">Production branch</span>
              <div class="bg-gray-900 rounded px-3 py-2 mt-1 text-white">main</div>
            </div>
            <div>
              <span class="text-gray-400 text-sm">Framework preset</span>
              <div class="bg-gray-900 rounded px-3 py-2 mt-1 text-white">Vite</div>
            </div>
            <div>
              <span class="text-gray-400 text-sm">Build command</span>
              <div class="bg-gray-900 rounded px-3 py-2 mt-1 font-mono text-green-400">npm run build</div>
            </div>
            <div>
              <span class="text-gray-400 text-sm">Build output directory</span>
              <div class="bg-gray-900 rounded px-3 py-2 mt-1 font-mono text-green-400">dist</div>
            </div>
          </div>
        </div>

        <h3 class="text-lg font-bold text-white mt-6 mb-3">2.4 Set Environment Variables</h3>

        <p class="text-text-secondary mb-4">
          Set the API URL in the "Environment variables" section.
          For now, leave it empty since we're using the local backend.
        </p>

        <Callout client:load variant="info" title="After Backend Deployment" locale="en">
          <p class="text-sm">
            After deploying the backend to Cloud Run or similar, set the <code>VITE_API_URL</code> environment variable
            to the backend URL.
          </p>
        </Callout>

        <p class="text-text-secondary mt-4 mb-4">
          Click the "Save and Deploy" button to start the build.
        </p>
      </section>

      <!-- Section 3: Verify Deployment -->
      <section class="mb-10">
        <SectionHeader number={3} title="Verify Deployment" />

        <p class="text-text-secondary mb-4">
          Once the build is complete, a URL will be generated:
        </p>

        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 text-center">
          <p class="text-gray-400 text-sm mb-2">Your site is live at</p>
          <div class="flex items-center justify-center gap-2">
            <span class="text-2xl font-bold text-primary">https://my-admin.pages.dev</span>
            <button class="p-2 hover:bg-gray-700 rounded transition-colors">
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
            </button>
          </div>
          <p class="text-gray-500 text-xs mt-2">(Your actual URL may differ)</p>
        </div>

        <div class="mt-6 p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
          <div class="flex items-center gap-2 text-green-400 font-bold mb-2">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
            </svg>
            Deployment Successful!
          </div>
          <p class="text-green-300/80 text-sm">
            You can now share this URL with your friends!
          </p>
        </div>
      </section>

      <!-- Section 4: Backend Deployment (Brief) -->
      <section class="mb-10">
        <SectionHeader number={4} title="Backend Deployment (Next Step)" />

        <p class="text-text-secondary mb-4">
          Currently only the frontend is deployed.
          The backend still only runs locally (<code>localhost:8000</code>).
        </p>

        <Callout client:load variant="info" title="Backend Deployment Options" locale="en">
          <p class="text-sm mb-2">To deploy the backend, choose one of the following:</p>
          <ul class="list-disc list-inside space-y-1 text-sm">
            <li><strong>Google Cloud Run</strong> - Free tier available, auto-scaling</li>
            <li><strong>Railway</strong> - Easy deployment, starting at $5/month</li>
            <li><strong>Render</strong> - Free tier available, slow cold starts</li>
          </ul>
          <p class="text-sm mt-2">
            For a detailed guide, see the <a href="/en/deploy/cloud-run" class="text-primary hover:underline">Cloud Run Deployment Guide</a>.
          </p>
        </Callout>

        <p class="text-text-secondary mt-4">
          For now, test the frontend deployment while running the backend locally.
          Backend deployment will be covered in the next learning cycle.
        </p>
      </section>

      <!-- SPA 404 Resolution -->
      <section class="mb-10">
        <Callout client:load variant="warning" title="Getting 404 on Page Refresh?" locale="en">
          <p class="text-sm mb-2">
            If you use React Router, refreshing the page may result in a 404 error.
          </p>
          <p class="text-sm">
            Create a <code>public/_redirects</code> file and add the following:
          </p>
          <div class="mt-2 bg-gray-900 rounded px-3 py-2 font-mono text-sm">
            /* /index.html 200
          </div>
          <p class="text-sm mt-2">
            For detailed solutions, see the <a href="/en/fix/spa-404" class="text-primary hover:underline">SPA 404 Troubleshooting</a> guide.
          </p>
        </Callout>
      </section>

      <!-- Checklist -->
      <section class="mb-10">
        <Checklist
          client:load
          locale="en"
          storageKey="60min-deploy"
          title="Deployment Completion Checklist"
          items={checklist}
        />
      </section>

      <!-- Navigation -->
      <PageNavigation currentPath="/start/60min/deploy" lang="en" />
    </article>
  </div>
</DocsLayout>
